/*
THIS IS A GENERATED/BUNDLED FILE BY VITE
if you want to view the source, please visit the github repository https://github.com/Myriad-Dreamin/typst.ts/blob/main/packages/typst.ts
*/
var Le = Object.defineProperty;
var Oe = (n, t, e) => t in n ? Le(n, t, { enumerable: !0, configurable: !0, writable: !0, value: e }) : n[t] = e;
var p = (n, t, e) => Oe(n, typeof t != "symbol" ? t + "" : t, e);
const Fe = [
  "DejaVuSansMono-Bold.ttf",
  "DejaVuSansMono-BoldOblique.ttf",
  "DejaVuSansMono-Oblique.ttf",
  "DejaVuSansMono.ttf",
  "LibertinusSerif-Bold.otf",
  "LibertinusSerif-BoldItalic.otf",
  "LibertinusSerif-Italic.otf",
  "LibertinusSerif-Regular.otf",
  "LibertinusSerif-Semibold.otf",
  "LibertinusSerif-SemiboldItalic.otf",
  "NewCM10-Bold.otf",
  "NewCM10-BoldItalic.otf",
  "NewCM10-Italic.otf",
  "NewCM10-Regular.otf",
  "NewCMMath-Bold.otf",
  "NewCMMath-Book.otf",
  "NewCMMath-Regular.otf"
], De = [
  "InriaSerif-Bold.ttf",
  "InriaSerif-BoldItalic.ttf",
  "InriaSerif-Italic.ttf",
  "InriaSerif-Regular.ttf",
  "Roboto-Regular.ttf",
  "NotoSerifCJKsc-Regular.otf"
], $e = ["TwitterColorEmoji.ttf", "NotoColorEmoji-Regular-COLR.subset.ttf"];
function je(n) {
  var e, r;
  const t = [];
  if (n && (n == null ? void 0 : n.assets) !== !1 && ((e = n == null ? void 0 : n.assets) != null && e.length) && ((r = n == null ? void 0 : n.assets) == null ? void 0 : r.length) > 0) {
    let i = {
      text: "https://cdn.jsdelivr.net/gh/typst/typst-assets@v0.13.1/files/fonts/",
      _: "https://cdn.jsdelivr.net/gh/typst/typst-dev-assets@v0.13.1/files/fonts/"
    }, o = n.assetUrlPrefix ?? i;
    typeof o == "string" ? o = { _: o } : o = { ...i, ...o };
    for (const c of Object.keys(o)) {
      const d = o[c];
      d[d.length - 1] !== "/" && (o[c] = d + "/");
    }
    const s = (c, d) => d.map((g) => (o[c] || o._) + g);
    for (const c of n.assets)
      switch (c) {
        case "text":
          t.push(...s(c, Fe));
          break;
        case "cjk":
          t.push(...s(c, De));
          break;
        case "emoji":
          t.push(...s(c, $e));
          break;
      }
  }
  return t;
}
function St(n, t) {
  const e = je(t), r = async (i, { ref: o, builder: s }) => {
    t != null && t.fetcher && o.setFetcher(t.fetcher), await o.loadFonts(s, [...n, ...e]);
  };
  return r._preloadRemoteFontOptions = t, r._kind = "fontLoader", r;
}
function Ot({ byFamily: n }) {
  return async (t, { builder: e }) => {
    const r = performance.now();
    if ("queryLocalFonts" in window) {
      const o = await window.queryLocalFonts();
      n = n ?? [];
      for (const s of o) {
        if (!n.includes(s.family))
          continue;
        const c = await (await s.blob()).arrayBuffer();
        await e.add_raw_font(new Uint8Array(c));
      }
    }
    const i = performance.now();
    console.log("preload system font time used:", i - r);
  };
}
function We(n) {
  return async (t, { builder: e }) => new Promise((r) => {
    e.set_package_registry(n, function(i) {
      return n.resolve(i, this);
    }), r();
  });
}
function Be(n) {
  return async (t, e) => {
    var r;
    if (e.alreadySetAccessModel)
      throw new Error(
        `already set some assess model before: ${(r = e.alreadySetAccessModel.constructor) == null ? void 0 : r.name}(${e.alreadySetAccessModel})`
      );
    return e.alreadySetAccessModel = n, new Promise((i) => {
      e.builder.set_access_model(
        n,
        (o) => {
          const s = n.getMTime(o);
          return s ? s.getTime() : 0;
        },
        (o) => n.isFile(o) || !1,
        (o) => n.getRealPath(o) || o,
        (o) => n.readAll(o)
      ), i();
    });
  };
}
const E = Symbol.for("reflexo-obj");
var Pt = /* @__PURE__ */ ((n) => (n[n.PIXEL_PER_PT = 3] = "PIXEL_PER_PT", n))(Pt || {});
class se {
  constructor(t, e, r) {
    p(this, "loadPageCount");
    p(this, "imageScaleFactor");
    p(this, "container");
    p(this, "canvasList");
    p(this, "textLayerList");
    p(this, "commonList");
    p(this, "textLayerParentList");
    p(this, "semanticLayerList");
    this.pageInfos = t, this.imageScaleFactor = r.pixelPerPt ?? Pt.PIXEL_PER_PT, e.innerHTML = "", e.style.width = "100%", this.container = e, this.canvasList = new Array(this.loadPageCount), this.textLayerList = new Array(this.loadPageCount), this.commonList = new Array(this.loadPageCount), this.textLayerParentList = new Array(this.loadPageCount), this.semanticLayerList = new Array(this.loadPageCount);
    const i = (o, s, c) => {
      const d = Math.ceil(s.width) * this.imageScaleFactor, g = Math.ceil(s.height) * this.imageScaleFactor, w = this.canvasList[o] = document.createElement("canvas"), v = this.semanticLayerList[o] = document.createElement("div"), T = this.textLayerList[o] = document.createElement("div"), C = this.textLayerParentList[o] = document.createElement("div");
      if (w.getContext("2d")) {
        const D = document.createElement("div");
        w.width = d, w.height = g, D.appendChild(w), c.appendChild(D), D.style.position = "absolute";
      }
      {
        C.appendChild(T), C.className = "typst-html-semantics";
        const D = e.offsetWidth, z = D / s.width;
        C.style.width = `${D}px`, C.style.height = `${s.height * z}px`, C.style.setProperty("--data-text-width", `${z}px`), C.style.setProperty("--data-text-height", `${z}px`), c.classList.add("typst-page"), c.classList.add("canvas"), c.style.width = `${D}px`, c.style.height = `${g * z}px`, c.style.position = "relative", v.appendChild(C), c.appendChild(v);
      }
    };
    for (let o = 0; o < this.pageInfos.length; o++) {
      const s = this.pageInfos[o];
      let c;
      c = this.commonList[o] = document.createElement("div"), e.appendChild(c), i(o, s, c);
    }
  }
  resetLayout() {
    for (let t = 0; t < this.pageInfos.length; t++) {
      const e = this.pageInfos[t], r = Math.ceil(e.width) * this.imageScaleFactor, i = Math.ceil(e.height) * this.imageScaleFactor, o = this.canvasList[t].parentElement;
      if (!o)
        throw new Error(
          `canvasDiv is null for page ${t}, canvas list length ${this.canvasList.length}`
        );
      const s = this.commonList[t], c = this.textLayerParentList[t], d = this.container.offsetWidth, g = d / r;
      c.style.width = `${d}px`, c.style.height = `${i * g}px`, s.style.width = `${d}px`, s.style.height = `${i * g}px`;
      const w = this.container.offsetWidth / r;
      o.style.transformOrigin = "0px 0px", o.style.transform = `scale(${w})`;
    }
  }
}
const ze = (n) => {
  let t = !1, e;
  return () => t ? e : (t = !0, e = n());
};
class _e {
  constructor(t) {
    p(this, "wasmBin");
    p(this, "initOnce");
    if (typeof t != "function")
      throw new Error("initFn is not a function");
    this.initOnce = ze(async () => {
      await t(this.wasmBin);
    });
  }
  async init(t) {
    this.wasmBin = t, await this.initOnce();
  }
}
const Ue = (n, t) => t.some((e) => n instanceof e);
let Ft, Dt;
function qe() {
  return Ft || (Ft = [
    IDBDatabase,
    IDBObjectStore,
    IDBIndex,
    IDBCursor,
    IDBTransaction
  ]);
}
function Ne() {
  return Dt || (Dt = [
    IDBCursor.prototype.advance,
    IDBCursor.prototype.continue,
    IDBCursor.prototype.continuePrimaryKey
  ]);
}
const ae = /* @__PURE__ */ new WeakMap(), Rt = /* @__PURE__ */ new WeakMap(), ce = /* @__PURE__ */ new WeakMap(), mt = /* @__PURE__ */ new WeakMap(), Tt = /* @__PURE__ */ new WeakMap();
function He(n) {
  const t = new Promise((e, r) => {
    const i = () => {
      n.removeEventListener("success", o), n.removeEventListener("error", s);
    }, o = () => {
      e(tt(n.result)), i();
    }, s = () => {
      r(n.error), i();
    };
    n.addEventListener("success", o), n.addEventListener("error", s);
  });
  return t.then((e) => {
    e instanceof IDBCursor && ae.set(e, n);
  }).catch(() => {
  }), Tt.set(t, n), t;
}
function Ve(n) {
  if (Rt.has(n))
    return;
  const t = new Promise((e, r) => {
    const i = () => {
      n.removeEventListener("complete", o), n.removeEventListener("error", s), n.removeEventListener("abort", s);
    }, o = () => {
      e(), i();
    }, s = () => {
      r(n.error || new DOMException("AbortError", "AbortError")), i();
    };
    n.addEventListener("complete", o), n.addEventListener("error", s), n.addEventListener("abort", s);
  });
  Rt.set(n, t);
}
let At = {
  get(n, t, e) {
    if (n instanceof IDBTransaction) {
      if (t === "done")
        return Rt.get(n);
      if (t === "objectStoreNames")
        return n.objectStoreNames || ce.get(n);
      if (t === "store")
        return e.objectStoreNames[1] ? void 0 : e.objectStore(e.objectStoreNames[0]);
    }
    return tt(n[t]);
  },
  set(n, t, e) {
    return n[t] = e, !0;
  },
  has(n, t) {
    return n instanceof IDBTransaction && (t === "done" || t === "store") ? !0 : t in n;
  }
};
function Je(n) {
  At = n(At);
}
function Ge(n) {
  return n === IDBDatabase.prototype.transaction && !("objectStoreNames" in IDBTransaction.prototype) ? function(t, ...e) {
    const r = n.call(yt(this), t, ...e);
    return ce.set(r, t.sort ? t.sort() : [t]), tt(r);
  } : Ne().includes(n) ? function(...t) {
    return n.apply(yt(this), t), tt(ae.get(this));
  } : function(...t) {
    return tt(n.apply(yt(this), t));
  };
}
function Ke(n) {
  return typeof n == "function" ? Ge(n) : (n instanceof IDBTransaction && Ve(n), Ue(n, qe()) ? new Proxy(n, At) : n);
}
function tt(n) {
  if (n instanceof IDBRequest)
    return He(n);
  if (mt.has(n))
    return mt.get(n);
  const t = Ke(n);
  return t !== n && (mt.set(n, t), Tt.set(t, n)), t;
}
const yt = (n) => Tt.get(n), Xe = ["get", "getKey", "getAll", "getAllKeys", "count"], Qe = ["put", "add", "delete", "clear"], vt = /* @__PURE__ */ new Map();
function $t(n, t) {
  if (!(n instanceof IDBDatabase && !(t in n) && typeof t == "string"))
    return;
  if (vt.get(t))
    return vt.get(t);
  const e = t.replace(/FromIndex$/, ""), r = t !== e, i = Qe.includes(e);
  if (
    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.
    !(e in (r ? IDBIndex : IDBObjectStore).prototype) || !(i || Xe.includes(e))
  )
    return;
  const o = async function(s, ...c) {
    const d = this.transaction(s, i ? "readwrite" : "readonly");
    let g = d.store;
    return r && (g = g.index(c.shift())), (await Promise.all([
      g[e](...c),
      i && d.done
    ]))[0];
  };
  return vt.set(t, o), o;
}
Je((n) => ({
  ...n,
  get: (t, e, r) => $t(t, e) || n.get(t, e, r),
  has: (t, e) => !!$t(t, e) || n.has(t, e)
}));
class Ye {
  constructor() {
    p(this, "loadedFonts", /* @__PURE__ */ new Set());
    p(this, "fetcher", fetch);
  }
  setFetcher(t) {
    this.fetcher = t;
  }
  async loadFonts(t, e) {
    const r = new Function("m", "return import(m)"), i = this.fetcher || (this.fetcher = await async function() {
      const { fetchBuilder: c, FileSystemCache: d } = await r("node-fetch-cache"), g = new d({
        /// By default, we don't have a complicated cache policy.
        cacheDirectory: ".cache/typst/fonts"
      }), w = c.withCache(g);
      return function(v, T) {
        const C = setTimeout(() => {
          console.warn("font fetching is stucking:", v);
        }, 15e3);
        return w(v, T).finally(() => {
          clearTimeout(C);
        });
      };
    }()), o = e.filter((c) => c instanceof Uint8Array ? !0 : this.loadedFonts.has(c) ? !1 : (this.loadedFonts.add(c), !0)), s = await Promise.all(
      o.map(async (c) => {
        if (c instanceof Uint8Array) {
          await t.add_raw_font(c);
          return;
        }
        return new Uint8Array(await (await i(c)).arrayBuffer());
      })
    );
    for (const c of s)
      c && await t.add_raw_font(c);
  }
  async build(t, e, r) {
    const i = { ref: this, builder: e, hooks: r };
    for (const s of (t == null ? void 0 : t.beforeBuild) ?? [])
      await s(void 0, i);
    return r.latelyBuild && r.latelyBuild(i), await e.build();
  }
}
async function ue(n, t, e, r) {
  var i;
  return await t.init((i = n == null ? void 0 : n.getModule) == null ? void 0 : i.call(n)), await new Ye().build(n, new e(), r);
}
class Lt {
  constructor(t) {
    p(this, "hookedElem");
    p(this, "kModule");
    p(this, "opts");
    p(this, "modes", []);
    /// Configuration fields
    /// enable partial rendering
    p(this, "partialRendering", !0);
    /// underlying renderer
    p(this, "renderMode", "svg");
    p(this, "r");
    /// preview mode
    p(this, "previewMode", 0);
    /// whether this is a content preview
    p(this, "isContentPreview", !1);
    /// whether this content preview will mix outline titles
    p(this, "isMixinOutline", !1);
    /// background color
    p(this, "backgroundColor", "black");
    /// default page color (empty string means transparent)
    p(this, "pageColor", "white");
    /// pixel per pt
    p(this, "pixelPerPt", 3);
    /// customized way to retrieving dom state
    p(this, "retrieveDOMState");
    /// State fields
    /// whether svg is updating (in triggerSvgUpdate)
    p(this, "isRendering", !1);
    /// whether kModule is initialized
    p(this, "moduleInitialized", !1);
    /// patch queue for updating data.
    p(this, "patchQueue", []);
    /// resources to dispose
    p(this, "disposeList", []);
    /// canvas render ctoken
    p(this, "canvasRenderCToken");
    /// There are two scales in this class: The real scale is to adjust the size
    /// of `hookedElem` to fit the svg. The virtual scale (scale ratio) is to let
    /// user zoom in/out the svg. For example:
    /// + the default value of virtual scale is 1, which means the svg is totally
    ///   fit in `hookedElem`.
    /// + if user set virtual scale to 0.5, then the svg will be zoomed out to fit
    ///   in half width of `hookedElem`. "real" current scale of `hookedElem`
    p(this, "currentRealScale", 1);
    /// "virtual" current scale of `hookedElem`
    p(this, "currentScaleRatio", 1);
    /// timeout for delayed viewport change
    p(this, "vpTimeout");
    /// sampled by last render time.
    p(this, "sampledRenderTime", 0);
    /// page to partial render
    p(this, "partialRenderPage", 0);
    /// outline data
    p(this, "outline");
    /// cursor position in form of [page, x, y]
    p(this, "cursorPosition");
    // id: number = rnd++;
    /// Cache fields
    /// cached state of container, default to retrieve state from `this.hookedElem`
    p(this, "cachedDOMState", {
      width: 0,
      height: 0,
      window: {
        innerWidth: 0,
        innerHeight: 0
      },
      boundingRect: {
        left: 0,
        top: 0,
        right: 0
      }
    });
    var e, r;
    this.hookedElem = t.hookedElem, this.kModule = t.kModule, this.opts = t || {};
    {
      const { renderMode: i, previewMode: o, isContentPreview: s, retrieveDOMState: c } = t || {};
      this.partialRendering = !1, this.renderMode = i ?? this.renderMode, this.previewMode = o ?? this.previewMode, this.isContentPreview = s || !1, this.retrieveDOMState = c ?? (() => ({
        width: this.hookedElem.offsetWidth,
        height: this.hookedElem.offsetHeight,
        window: {
          innerWidth: window.innerWidth,
          innerHeight: window.innerHeight
        },
        boundingRect: this.hookedElem.getBoundingClientRect()
      })), this.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue(
        "--typst-preview-background-color"
      );
    }
    this.hookedElem.classList.add("hide-scrollbar-x"), (e = this.hookedElem.parentElement) == null || e.classList.add("hide-scrollbar-x"), this.previewMode === 1 && (this.hookedElem.classList.add("hide-scrollbar-y"), (r = this.hookedElem.parentElement) == null || r.classList.add("hide-scrollbar-y")), this.installCtrlWheelHandler();
  }
  reset() {
    this.kModule.reset(), this.moduleInitialized = !1;
  }
  dispose() {
    const t = this.disposeList;
    this.disposeList = [], t.forEach((e) => e());
  }
  static derive(t, e) {
    return ["rescale", "rerender", "postRender"].reduce((r, i) => (r[i] = t[`${i}$${e}`].bind(t), console.assert(r[i] !== void 0, `${i}$${e} is undefined`), r), {});
  }
  registerMode(t) {
    const e = Lt.derive(this, t);
    this.modes.push([t, e]), t === this.renderMode && (this.r = e);
  }
  installCtrlWheelHandler() {
    const t = [
      0.1,
      0.2,
      0.3,
      0.4,
      0.5,
      0.6,
      0.7,
      0.8,
      0.9,
      1,
      1.1,
      1.3,
      1.5,
      1.7,
      1.9,
      2.1,
      2.4,
      2.7,
      3,
      3.3,
      3.7,
      4.1,
      4.6,
      5.1,
      5.7,
      6.3,
      7,
      7.7,
      8.5,
      9.4,
      10
    ], e = (r) => {
      var i, o, s, c;
      if (r.ctrlKey) {
        r.preventDefault(), this.cachedDOMState = this.retrieveDOMState(), window.onresize !== null && (window.onresize = null);
        const d = this.currentScaleRatio;
        if (r.deltaY < 0) {
          if (this.currentScaleRatio >= t.at(-1))
            return;
          this.currentScaleRatio = t.filter((C) => C > this.currentScaleRatio).at(0);
        } else if (r.deltaY > 0) {
          if (this.currentScaleRatio <= t.at(0))
            return;
          this.currentScaleRatio = t.filter((C) => C < this.currentScaleRatio).at(-1);
        } else
          return;
        const g = this.currentScaleRatio / d, w = r.pageX * (g - 1), v = r.pageY * (g - 1);
        Math.abs(this.currentScaleRatio - 1) < 1e-5 ? (this.hookedElem.classList.add("hide-scrollbar-x"), (i = this.hookedElem.parentElement) == null || i.classList.add("hide-scrollbar-x"), this.previewMode === 1 && (this.hookedElem.classList.add("hide-scrollbar-y"), (o = this.hookedElem.parentElement) == null || o.classList.add("hide-scrollbar-y"))) : (this.hookedElem.classList.remove("hide-scrollbar-x"), (s = this.hookedElem.parentElement) == null || s.classList.remove("hide-scrollbar-x"), this.previewMode === 1 && (this.hookedElem.classList.remove("hide-scrollbar-y"), (c = this.hookedElem.parentElement) == null || c.classList.remove("hide-scrollbar-y")));
        const T = this.hookedElem.firstElementChild;
        if (T) {
          const C = this.getSvgScaleRatio(), B = Number.parseFloat(T.getAttribute("data-height")), D = Math.ceil(B * C);
          this.hookedElem.style.height = `${D * 2}px`;
        }
        return window.scrollBy(w, v), this.addViewportChange(), !1;
      }
    };
    this.renderMode !== "dom" && (typeof acquireVsCodeApi < "u" ? (window.addEventListener("wheel", e, {
      passive: !1
    }), this.disposeList.push(() => {
      window.removeEventListener("wheel", e);
    })) : (document.body.addEventListener("wheel", e, {
      passive: !1
    }), this.disposeList.push(() => {
      document.body.removeEventListener("wheel", e);
    })));
  }
  /// Get current scale from html to svg
  // Note: one should retrieve dom state before rescale
  getSvgScaleRatio() {
    const t = this.hookedElem.firstElementChild;
    if (!t)
      return 0;
    const e = this.cachedDOMState, r = Number.parseFloat(
      t.getAttribute("data-width") || t.getAttribute("width") || "1"
    ), i = Number.parseFloat(
      t.getAttribute("data-height") || t.getAttribute("height") || "1"
    );
    return this.currentRealScale = this.previewMode === 1 ? Math.min(e.width / r, e.height / i) : e.width / r, this.currentRealScale * this.currentScaleRatio;
  }
  processQueue(t) {
    const e = t[0];
    switch (e) {
      case "new":
      case "diff-v1":
        return e === "new" && this.reset(), this.kModule.manipulateData({
          action: "merge",
          data: t[1]
        }), this.moduleInitialized = !0, !0;
      case "viewport-change":
        return this.moduleInitialized ? !0 : (console.log("viewport-change before initialization"), !1);
      default:
        return console.log("svgUpdateEvent", t), !1;
    }
  }
  triggerUpdate() {
    if (this.isRendering)
      return;
    this.isRendering = !0;
    const t = async () => {
      if (this.cachedDOMState = this.retrieveDOMState(), this.patchQueue.length === 0) {
        this.isRendering = !1, this.postprocessChanges();
        return;
      }
      try {
        let e = performance.now();
        const r = this.canvasRenderCToken;
        r && (await r.cancel(), await r.wait(), this.canvasRenderCToken = void 0, console.log("cancel canvas rendering"));
        let i = !1;
        for (; this.patchQueue.length > 0; )
          i = this.processQueue(this.patchQueue.shift()) || i;
        let o = performance.now();
        i && (this.r.rescale(), await this.r.rerender(), this.r.rescale());
        let s = performance.now();
        const c = (d, g, w) => `${d} ${(w - g).toFixed(2)} ms`;
        this.sampledRenderTime = s - e, console.log([c("parse", e, o), c("rerender", o, s), c("total", e, s)].join(", ")), requestAnimationFrame(t);
      } catch (e) {
        console.error(e), this.isRendering = !1, this.postprocessChanges();
      }
    };
    requestAnimationFrame(t);
  }
  postprocessChanges() {
    this.r.postRender(), this.previewMode === 1 && document.querySelectorAll(".typst-page-number-indicator").forEach((t) => {
      t.textContent = `${this.kModule.retrievePagesInfo().length}`;
    });
  }
  addChangement(t) {
    t[0] === "new" && this.patchQueue.splice(0, this.patchQueue.length);
    const e = () => {
      this.vpTimeout = void 0, this.patchQueue.push(t), this.triggerUpdate();
    };
    this.vpTimeout !== void 0 && clearTimeout(this.vpTimeout), t[0] === "viewport-change" && this.isRendering ? this.vpTimeout = setTimeout(e, this.sampledRenderTime || 100) : e();
  }
  addViewportChange() {
    this.addChangement(["viewport-change", ""]);
  }
}
function Ze(n) {
  return class {
    constructor(e) {
      p(this, "impl");
      p(this, "kModule");
      if (e.isContentPreview && (e.renderMode = "canvas"), this.kModule = e.kModule, this.impl = new n(e), !this.impl.r)
        throw new Error(`mode is not supported, ${e == null ? void 0 : e.renderMode}`);
      e.isContentPreview && (this.impl.partialRendering = !0, this.impl.pixelPerPt = 1, this.impl.isMixinOutline = !0);
    }
    dispose() {
      this.impl.dispose();
    }
    reset() {
      this.impl.reset();
    }
    addChangement(e) {
      this.impl.addChangement(e);
    }
    addViewportChange() {
      this.impl.addViewportChange();
    }
    setPageColor(e) {
      this.impl.pageColor = e, this.addViewportChange();
    }
    setPartialRendering(e) {
      this.impl.partialRendering = e;
    }
    setCursor(e, r, i) {
      this.impl.cursorPosition = [e, r, i];
    }
    setPartialPageNumber(e) {
      return e <= 0 || e > this.kModule.retrievePagesInfo().length ? !1 : (this.impl.partialRenderPage = e - 1, this.addViewportChange(), !0);
    }
    getPartialPageNumber() {
      return this.impl.partialRenderPage + 1;
    }
    setOutineData(e) {
      this.impl.outline = e, this.addViewportChange();
    }
  };
}
function tn(n, ...t) {
  return t.reduce((e, r) => r(e), n);
}
class en {
  constructor() {
    p(this, "isCancellationRequested", !1);
    p(this, "_onCancelled");
    p(this, "_onCancelledResolveResolved");
    let t, e;
    this._onCancelled = new Promise((r) => {
      t = r, e && e(r);
    }), this._onCancelledResolveResolved = new Promise((r) => {
      e = r, t && r(t);
    });
  }
  async cancel() {
    await this._onCancelledResolveResolved, this.isCancellationRequested = !0;
  }
  isCancelRequested() {
    return this.isCancellationRequested;
  }
  async consume() {
    (await this._onCancelledResolveResolved)();
  }
  wait() {
    return this._onCancelled;
  }
}
const nn = () => new Promise((n) => requestAnimationFrame(n));
function rn(n) {
  return class extends n {
    constructor(...r) {
      super(...r);
      /// The template element for creating DOM by string.
      p(this, "tmpl", document.createElement("template"));
      /// The stub element for replacing an invisible element.
      p(this, "stub", this.createElement("<stub></stub>"));
      /// Typescript side of lib.
      p(this, "plugin");
      /// Rust side of kernel.
      p(this, "docKernel");
      /// The element to track.
      p(this, "resourceHeader");
      /// Expected exact state of the current DOM.
      /// Initially it is empty meaning no any page is rendered.
      p(this, "pages", []);
      /// The virtual scale of the document.
      p(this, "domScale", 1);
      /// Track mode.
      p(this, "track_mode", 0);
      /// Current executing task.
      p(this, "current_task");
      /// The currently maintained viewport.
      p(this, "viewport");
      if (this.registerMode("dom"), this.disposeList.push(() => {
        this.dispose();
      }), this.plugin = this.opts.renderer, this.opts.domScale !== void 0) {
        if (this.opts.domScale <= 0)
          throw new Error("domScale must be positive");
        this.domScale = this.opts.domScale;
      }
    }
    dispose() {
      for (const r of this.pages)
        r.dispose();
      this.docKernel && this.docKernel.free();
    }
    createElement(r) {
      return this.tmpl.innerHTML = r, this.tmpl.content.firstElementChild;
    }
    async mountDom(r) {
      if (console.log("mountDom", r), this.docKernel)
        throw new Error("already mounted");
      this.hookedElem.innerHTML = '<svg class="typst-svg-resources" viewBox="0 0 0 0" width="0" height="0" style="opacity: 0; position: absolute;"></svg>', this.resourceHeader = this.hookedElem.querySelector(".typst-svg-resources"), this.docKernel = await this.plugin.renderer.mount_dom(this.kModule[E], this.hookedElem), this.docKernel.bind_functions({
        populateGlyphs: (i) => {
          let o = this.createElement(i);
          console.log("populateGlyphs", o);
          let s = o.firstElementChild;
          this.resourceHeader.append(s);
        }
      });
    }
    async cancelAnyway$dom() {
      if (console.log("cancelAnyway$dom"), this.current_task) {
        const r = this.current_task;
        this.current_task = void 0, await r.cancel();
      }
    }
    retrieveDOMPages() {
      return Array.from(this.hookedElem.querySelectorAll(".typst-dom-page"));
    }
    // doesn't need to postRender
    postRender$dom() {
    }
    // doesn't need to rescale
    rescale$dom() {
    }
    getDomViewport(r, i) {
      const o = i.left, s = -i.top, c = i.right, d = r.innerHeight - i.top, g = {
        x: 0,
        y: s / this.domScale,
        width: Math.max(c - o, 0) / this.domScale,
        height: Math.max(d - s, 0) / this.domScale
      };
      return (g.width <= 0 || g.height <= 0) && (g.x = g.y = g.width = g.height = 0), g;
    }
    // fast mode
    async rerender$dom() {
      const r = this.retrieveDOMState(), { x: i, y: o, width: s, height: c } = this.getDomViewport(r.window, r.boundingRect);
      if (!await this.docKernel.relayout(i, o, s, c))
        return;
      const g = new en();
      this.doRender$dom(g), this.current_task = g;
    }
    async doRender$dom(r) {
      const i = (d, g) => {
        if (d && !r.isCancelRequested() && g)
          return g();
      }, o = this.retrieveDOMPages().map((d) => {
        const { innerWidth: g, innerHeight: w } = window, v = d.getBoundingClientRect();
        return {
          inWindow: !(v.left > g || v.right < 0 || v.top > w || v.bottom < 0),
          page: d
        };
      }), s = async (d) => {
        if (await nn(), r.isCancelRequested()) {
          console.log("cancel stage", 0, d);
          return;
        }
        const g = o[d].page, w = g.getBoundingClientRect(), v = this.getDomViewport(window, w), T = (j) => this.docKernel.need_repaint(d, v.x, v.y, v.width, v.height, j), C = (j) => this.docKernel.repaint(d, v.x, v.y, v.width, v.height, j), B = (j) => {
          if (!r.isCancelRequested())
            return i(T(j), () => C(j));
        };
        await B(
          0
          /* Layout */
        );
        const D = (w.width ? Number.parseFloat(g.getAttribute("data-width")) / w.width : 1) * this.domScale, z = (w.height ? Number.parseFloat(g.getAttribute("data-height")) / w.height : 1) * this.domScale;
        if (v.x *= D, v.y *= z, v.y -= 100, v.width *= D, v.height *= z, v.height += 200, await B(
          1
          /* Svg */
        ), await B(
          2
          /* Semantics */
        ), r.isCancelRequested()) {
          console.log("cancel stage", 2, d);
          return;
        }
        T(
          3
          /* PrepareCanvas */
        ) ? (async () => {
          if (await C(
            3
            /* PrepareCanvas */
          ), !r.isCancelRequested())
            return B(
              4
              /* Canvas */
            );
        })() : await B(
          4
          /* Canvas */
        );
      }, c = async (d) => {
        for (let g = 0; g < o.length; ++g) {
          if (r.isCancelRequested()) {
            console.log("cancel page", 0, g);
            return;
          }
          o[g].inWindow === d && await s(g);
        }
      };
      this.cancelAnyway$dom(), await c(!0), await c(!1), !r.isCancelRequested() && console.log(
        "finished",
        0
        /* Layout */
      );
    }
  };
}
class on extends Ze(
  tn(
    Lt,
    rn
  )
) {
}
var re;
let xt = (re = E, class {
  /**
   * @internal
   */
  constructor(t, e) {
    /**
     * @internal
     */
    p(this, re);
    this.plugin = t, this[E] = e;
  }
  /**
   * @deprecated set in {@link RenderToCanvasOptions} instead
   *
   * Set the background color of the Typst document.
   * @param {string} t - The background color in format of `^#?[0-9a-f]{6}$`
   *
   * Note: Default to `#ffffff`.
   *
   * Note: Only available in canvas rendering mode.
   */
  set backgroundColor(t) {
    t !== void 0 && (this[E].background_color = t);
  }
  /**
   * Get the background color of the Typst document.
   *
   * Note: Default to `#ffffff`.
   *
   * Note: Only available in canvas rendering mode.
   */
  get backgroundColor() {
    return this[E].background_color;
  }
  /**
   * Set the pixel per point scale up the canvas panel.
   *
   * Note: Default to `3`.
   *
   * Note: Only available in canvas rendering mode.
   */
  set pixelPerPt(t) {
    t !== void 0 && (this[E].pixel_per_pt = t);
  }
  /**
   * @deprecated set in {@link RenderToCanvasOptions} instead
   *
   * Get the pixel per point scale up the canvas panel.
   *
   * Note: Default to `3`.
   *
   * Note: Only available in canvas rendering mode.
   */
  get pixelPerPt() {
    return this[E].pixel_per_pt;
  }
  /**
   * Reset state
   */
  reset() {
    this.plugin.resetSession(this);
  }
  /**
   * @deprecated
   * use {@link docWidth} instead
   */
  get doc_width() {
    return this[E].doc_width;
  }
  get docWidth() {
    return this[E].doc_width;
  }
  /**
   * @deprecated
   * use {@link docHeight} instead
   */
  get doc_height() {
    return this[E].doc_height;
  }
  get docHeight() {
    return this[E].doc_height;
  }
  retrievePagesInfo() {
    const t = this[E].pages_info, e = [], r = t.page_count;
    for (let i = 0; i < r; i++) {
      const o = t.page(i);
      e.push({
        pageOffset: o.page_off,
        width: o.width_pt,
        height: o.height_pt
      });
    }
    return e;
  }
  getSourceLoc(t) {
    return this[E].source_span(t);
  }
  /**
   * See {@link TypstRenderer#renderSvg} for more details.
   */
  renderSvg(t) {
    return this.plugin.renderSvg({
      renderSession: this,
      ...t
    });
  }
  /**
   * See {@link TypstRenderer#renderToSvg} for more details.
   */
  renderToSvg(t) {
    return this.plugin.renderToSvg({
      renderSession: this,
      ...t
    });
  }
  /**
   * See {@link TypstRenderer#renderCanvas} for more details.
   */
  renderCanvas(t) {
    return this.plugin.renderCanvas({
      renderSession: this,
      ...t
    });
  }
  /**
   * See {@link TypstRenderer#manipulateData} for more details.
   */
  manipulateData(t) {
    this.plugin.manipulateData({
      renderSession: this,
      ...t
    });
  }
  /**
   * See {@link TypstRenderer#renderSvgDiff} for more details.
   */
  renderSvgDiff(t) {
    return this.plugin.renderSvgDiff({
      renderSession: this,
      ...t
    });
  }
  /**
   * @deprecated
   * use {@link getSourceLoc} instead
   */
  get_source_loc(t) {
    return this[E].source_span(t);
  }
  /**
   * @deprecated
   * use {@link renderSvgDiff} instead
   */
  render_in_window(t, e, r, i) {
    return this[E].render_in_window(t, e, r, i);
  }
  /**
   * @deprecated
   * use {@link manipulateData} instead
   */
  merge_delta(t) {
    this.plugin.manipulateData({
      renderSession: this,
      action: "merge",
      data: t
    });
  }
});
var ie;
let sn = (ie = E, class {
  /**
   * @internal
   */
  constructor(t, e) {
    /**
     * @internal
     */
    p(this, ie);
    /**
     * @internal
     */
    p(this, "managedCanvasElemList", /* @__PURE__ */ new Map());
    /**
     * @internal
     */
    p(this, "canvasCounter", Math.random());
    this.plugin = t, this[E] = e;
  }
  /**
   * See {@link TypstRenderer#manipulateData} for more details.
   */
  manipulateData(t, e) {
    return this[E].manipulate_data(t, e);
  }
  /**
   * You must submit all canvas in pages to ensure synchronization with the background worker
   *
   * See {@link TypstRenderer#renderCanvas} for more details.
   */
  renderCanvas(t) {
    const e = this.managedCanvasElemList;
    for (const [c, d] of e)
      d[0] = 0;
    for (const c of t) {
      const d = c.canvas;
      let g = d.dataset.manageId, w = 2;
      g || (g = this.canvasCounter.toFixed(5), this.canvasCounter += 1, d.dataset.manageId = g, w = 1);
      let v = e.get(g);
      if (v && v[0] !== 0)
        throw new Error("cannot update a canvas for two times in batch");
      e.set(g, [w, { ...c }]);
    }
    const r = Array.from(e.entries()), i = new Uint8Array(r.length), o = new Array(r.length), s = r.map(([c, [d, g]], w) => (d || e.delete(c), i[w] = d, o[w] = g.canvas, this.plugin.canvasOptionsToRust(g)));
    return this[E].render_canvas(i, o, s);
  }
  async retrievePagesInfo() {
    const t = await this[E].get_pages_info();
    console.log(t);
    const e = [], r = t.page_count;
    for (let i = 0; i < r; i++) {
      const o = t.page(i);
      e.push({
        pageOffset: o.page_off,
        width: o.width_pt,
        height: o.height_pt
      });
    }
    return e;
  }
});
const _n = (n) => new _e(async (t) => await n.default(t));
function jt() {
  return new de();
}
function Xn() {
  return new de();
}
async function Qn() {
  return (await Promise.resolve().then(() => ye)).renderer_build_info();
}
let Wt = !0;
class de {
  constructor() {
    p(this, "renderer");
    p(this, "rendererJs");
  }
  async init(t) {
    var r;
    this.rendererJs = await (((r = t == null ? void 0 : t.getWrapper) == null ? void 0 : r.call(t)) || Promise.resolve().then(() => ye));
    const e = this.rendererJs.TypstRendererBuilder;
    this.renderer = await ue(
      t,
      _n(this.rendererJs),
      e,
      {}
    );
  }
  loadGlyphPack(t) {
    return Promise.resolve();
  }
  createOptionsToRust(t) {
    const e = new this.rendererJs.CreateSessionOptions();
    return t.format !== void 0 && (e.format = t.format), t.artifactContent !== void 0 && (e.artifact_content = t.artifactContent), e;
  }
  canvasOptionsToRust(t) {
    const e = new this.rendererJs.RenderPageImageOptions();
    if (t.pageOffset === void 0)
      throw new Error("pageOffset is required in reflexo v0.5.0");
    if (e.page_off = t.pageOffset, t.cacheKey !== void 0 && (e.cache_key = t.cacheKey), t.backgroundColor !== void 0 && (e.background_color = t.backgroundColor), t.pixelPerPt !== void 0 && (e.pixel_per_pt = t.pixelPerPt), t.dataSelection !== void 0) {
      let r = 0;
      t.dataSelection.body ? r |= 1 : t.canvas && Wt && (Wt = !1, console.warn("dataSelection.body is not set but providing canvas for body")), (t.dataSelection.text || t.dataSelection.annotation) && console.error("dataSelection.text and dataSelection.annotation are deprecated"), t.dataSelection.semantics && (r |= 8), e.data_selection = r;
    }
    return e;
  }
  retrievePagesInfoFromSession(t) {
    return t.retrievePagesInfo();
  }
  /**
   * Render a Typst document to canvas.
   */
  renderCanvas(t) {
    return this.withinOptionSession(t, async (e) => this.renderer.render_page_to_canvas(
      e[E],
      t.canvas || void 0,
      this.canvasOptionsToRust(t)
    ));
  }
  // async renderPdf(artifactContent: string): Promise<Uint8Array> {
  // return this.renderer.render_to_pdf(artifactContent);
  // }
  async inAnimationFrame(t) {
    return new Promise((e, r) => {
      requestAnimationFrame(() => {
        try {
          e(t());
        } catch (i) {
          r(i);
        }
      });
    });
  }
  async renderDisplayLayer(t, e, r) {
    const o = t[E].pages_info.page_count, s = async (w, v) => {
      const C = e[w].getContext("2d");
      if (!C)
        throw new Error("canvas context is null");
      return await this.renderCanvas({
        ...r,
        canvas: C,
        renderSession: t,
        pageOffset: v
      });
    }, c = performance.now(), d = await (async () => {
      const w = [];
      for (let v = 0; v < o; v++)
        w.push(await this.inAnimationFrame(() => s(v, v)));
      return w;
    })(), g = performance.now();
    return console.log(`display layer used: render = ${(g - c).toFixed(1)}ms`), d;
  }
  renderTextLayer(t, e) {
    const r = performance.now();
    t.forEach((o, s) => {
      o.innerHTML = e[s].htmlSemantics[0];
    });
    const i = performance.now();
    console.log(`text layer used: render = ${(i - r).toFixed(1)}ms`);
  }
  async render(t) {
    if ("format" in t && t.format !== "vector" && ["serde_json", "js", "ir"].includes(t.format))
      throw new Error(`deprecated format ${t.format}, please use vector format`);
    return this.renderToCanvas(t);
  }
  async renderDom(t) {
    if ("format" in t && t.format !== "vector" && ["serde_json", "js", "ir"].includes(t.format))
      throw new Error(`deprecated format ${t.format}, please use vector format`);
    return this.withinOptionSession(t, async (e) => {
      const r = new on({
        ...t,
        renderMode: "dom",
        hookedElem: t.container,
        kModule: e,
        renderer: this
      });
      return await r.impl.mountDom(t.pixelPerPt), r;
    });
  }
  async renderToCanvas(t) {
    let e, r;
    const i = t.container;
    i.style.visibility = "hidden";
    const o = async (s, c) => {
      try {
        r = await this.renderDisplayLayer(e, s, t), c();
      } finally {
        i.style.visibility = "visible";
      }
    };
    return this.withinOptionSession(t, async (s) => {
      if (e = s, e[E].pages_info.page_count === 0)
        throw new Error("No page found in session");
      if (t.pixelPerPt !== void 0 && t.pixelPerPt <= 0)
        throw new Error(
          "Invalid typst.RenderOptions.pixelPerPt, should be a positive number " + t.pixelPerPt
        );
      let c = t.backgroundColor;
      if (c !== void 0 && !/^#[0-9a-f]{6}$/.test(c))
        throw new Error(
          "Invalid typst.backgroundColor color for matching ^#?[0-9a-f]{6}$ " + c
        );
      e.pixelPerPt = t.pixelPerPt ?? Pt.PIXEL_PER_PT, e.backgroundColor = c ?? "#ffffff";
      const d = performance.now(), g = new se(
        this.retrievePagesInfoFromSession(e),
        i,
        t
      ), w = performance.now();
      console.log(`layer used: retrieve = ${(w - d).toFixed(1)}ms`), await o(g.canvasList, () => g.resetLayout()), this.renderTextLayer(g.textLayerList, r);
    });
  }
  createModule(t) {
    return Promise.resolve(
      new xt(
        this,
        this.renderer.create_session(
          t && this.createOptionsToRust({
            format: "vector",
            artifactContent: t
          })
        )
      )
    );
  }
  async createWorkerV0(t) {
    return new sn(this, await this.renderer.create_worker(t));
  }
  workerBridge() {
    return this.renderer.create_worker_bridge();
  }
  renderSvg(t, e) {
    if (t instanceof xt || e)
      throw new Error("removed api, please use renderToSvg({ renderSession, container }) instead");
    return this.withinOptionSession(t, async (r) => {
      let i;
      return t.data_selection && (i = 0, t.data_selection.body && (i |= 1), t.data_selection.defs && (i |= 2), t.data_selection.css && (i |= 4), t.data_selection.js && (i |= 8)), Promise.resolve(this.renderer.svg_data(r[E], i));
    });
  }
  renderSvgDiff(t) {
    return t.window ? this.renderer.render_svg_diff(
      t.renderSession[E],
      t.window.lo.x,
      t.window.lo.y,
      t.window.hi.x,
      t.window.hi.y
    ) : this.renderer.render_svg_diff(
      t.renderSession[E],
      0,
      0,
      1e33,
      1e33
    );
  }
  renderToSvg(t) {
    return this.withinOptionSession(t, async (e) => Promise.resolve(this.renderer.render_svg(e[E], t.container)));
  }
  getCustomV1(t) {
    return Promise.resolve(this.renderer.get_customs(t.renderSession[E]));
  }
  resetSession(t) {
    return this.renderer.reset(t[E]);
  }
  manipulateData(t) {
    return this.renderer.manipulate_data(
      t.renderSession[E],
      t.action ?? "reset",
      t.data
    );
  }
  withinOptionSession(t, e) {
    function r(i) {
      return "artifactContent" in i;
    }
    if ("renderSession" in t)
      return e(t.renderSession);
    if (r(t))
      return this.runWithSession(t, e);
    throw new Error(
      "Invalid render options, should be one of RenderByContentOptions|RenderBySessionOptions"
    );
  }
  async runWithSession(t, e) {
    let r = t, i = e;
    e || (r = void 0, i = t);
    const o = this.renderer.create_session(
      /* moved */
      r && this.createOptionsToRust(r)
    );
    try {
      const s = await i(new xt(this, o));
      return o.free(), s;
    } catch (s) {
      throw o.free(), s;
    }
  }
}
var oe;
oe = E;
class an {
  /**
   * @internal
   */
  constructor(t) {
    /**
     * @internal
     */
    p(this, oe);
    this[E] = t;
  }
  /**
   * Reset the incremental server to the initial state.
   */
  reset() {
    this[E].reset();
  }
  /**
   * Return current result.
   */
  current() {
    return this[E].current();
  }
  /**
   * Also attach the debug info to the result.
   */
  setAttachDebugInfo(t) {
    this[E].set_attach_debug_info(t);
  }
}
const cn = new _e(async (n) => await (await Promise.resolve().then(() => Ae)).default(n));
function ge() {
  return new ct();
}
const gt = class gt {
  constructor() {
    p(this, "compiler");
    p(this, "compilerJs");
  }
  async init(t) {
    this.compilerJs = await Promise.resolve().then(() => Ae);
    const e = this.compilerJs.TypstCompilerBuilder, r = { ...t || {} }, i = r.beforeBuild ?? (r.beforeBuild = []), o = i.some(
      (g) => g._preloadRemoteFontOptions !== void 0
    ), s = i.some(
      (g) => {
        var w;
        return ((w = g._preloadRemoteFontOptions) == null ? void 0 : w.assets) !== void 0;
      }
    ), c = i.some(
      (g) => {
        var w;
        return ((w = g._preloadRemoteFontOptions) == null ? void 0 : w.assets) === !1;
      }
    );
    if ((!o || !s && !c) && i.push(St([], { assets: gt.defaultAssets })), !i.some((g) => g._kind === "fontLoader"))
      throw new Error(
        "TypstCompiler: no font loader found, please use font loaders, e.g. preloadRemoteFonts or preloadSystemFonts"
      );
    this.compiler = await ue(t, cn, e, {});
  }
  compile(t) {
    return new Promise((e) => {
      if ("incrementalServer" in t) {
        e(
          this.compiler.incr_compile(
            t.mainFilePath,
            It(t.inputs),
            t.incrementalServer[E],
            Bt(t.diagnostics)
          )
        );
        return;
      }
      e(
        this.compiler.compile(
          t.mainFilePath,
          It(t.inputs),
          t.format || "vector",
          Bt(t.diagnostics)
        )
      );
    });
  }
  query(t) {
    return new Promise((e) => {
      e(
        JSON.parse(
          this.compiler.query(
            t.mainFilePath,
            It(t.inputs),
            t.selector,
            t.field
          )
        )
      );
    });
  }
  getSemanticTokenLegend() {
    return new Promise((t) => {
      t(this.compiler.get_semantic_token_legend());
    });
  }
  getSemanticTokens(t) {
    return new Promise((e) => {
      this.compiler.reset(), e(
        this.compiler.get_semantic_tokens(
          t.offsetEncoding || "utf-16",
          t.mainFilePath,
          t.resultId
        )
      );
    });
  }
  async withIncrementalServer(t) {
    const e = new an(this.compiler.create_incr_server());
    try {
      return await t(e);
    } finally {
      e[E].free();
    }
  }
  async getAst(t) {
    return this.compiler.get_ast(t);
  }
  async reset() {
    await new Promise((t) => {
      this.compiler.reset(), t(void 0);
    });
  }
  addSource(t, e) {
    if (arguments.length > 2)
      throw new Error(
        "use of addSource(path, source, isMain) is deprecated, please use addSource(path, source) instead"
      );
    this.compiler.add_source(t, e);
  }
  mapShadow(t, e) {
    this.compiler.map_shadow(t, e);
  }
  unmapShadow(t) {
    this.compiler.unmap_shadow(t);
  }
  resetShadow() {
    this.compiler.reset_shadow();
  }
  renderPageToCanvas() {
    throw new Error("Please use the api TypstRenderer.renderToCanvas in v0.4.0");
  }
};
p(gt, "defaultAssets", ["text"]);
let ct = gt;
ge._impl = ct;
function It(n) {
  return n ? Object.entries(n) : void 0;
}
function Bt(n) {
  switch (n) {
    case "none":
      return 1;
    case "unix":
      return 2;
    case "full":
    default:
      return 3;
  }
}
class un {
  constructor(t, e) {
    p(this, "fullyCached");
    p(this, "mTimes", /* @__PURE__ */ new Map());
    p(this, "mRealPaths", /* @__PURE__ */ new Map());
    p(this, "mData", /* @__PURE__ */ new Map());
    this.root = t, t.endsWith("/") && (this.root = this.root.slice(0, this.root.length - 1)), e != null && e.polyfillHeadRequest, this.fullyCached = !!(e != null && e.fullyCached);
  }
  reset() {
    this.mTimes.clear(), this.mRealPaths.clear(), this.mData.clear();
  }
  resolvePath(t) {
    return this.root + t;
  }
  insertFile(t, e, r) {
    this.mTimes.set(t, r), this.mData.set(t, e);
  }
  removeFile(t) {
    this.mTimes.delete(t), this.mData.delete(t);
  }
  async getPreloadScript() {
    const t = [];
    t.push("((async () => {"), t.push(
      "const snapshot = {  root: '', mTimes: new Map(),  mRealPaths: new Map(),  mData: [],};"
    ), t.push("const runFetch = async (path) => {"), t.push("  const res = await fetch(snapshot.root + path);"), t.push("  const buffer = await res.arrayBuffer();"), t.push("  return [path, new Uint8Array(buffer)];"), t.push("};"), t.push(`snapshot.root = ${JSON.stringify(this.root)};`), t.push(
      `snapshot.mTimes = new Map([${[...this.mTimes.entries()].map(([r, i]) => `[${JSON.stringify(r)}, ${(i == null ? void 0 : i.getTime()) || "undefined"}]`).join(", ")}]);`
    ), t.push(
      `snapshot.mRealPaths = new Map([${[...this.mRealPaths.entries()].map(([r, i]) => `[${JSON.stringify(r)}, ${JSON.stringify(i)}]`).join(", ")}]);`
    );
    const e = await Promise.all(
      [...this.mData.entries()].map(async ([r, i]) => (r = JSON.stringify(r), i ? `runFetch(${r})` : `Promise.resolve([${r}, undefined])`))
    );
    return t.push(`snapshot.mData = await Promise.all([${e.join(", ")}]);`), t.push("return snapshot;"), t.push("})())"), t.join(`
`);
  }
  getLastModified(t) {
    const e = new XMLHttpRequest();
    return e.open("HEAD", t, !1), e.send(null), e.status === 200 ? e.getResponseHeader("Last-Modified") : null;
  }
  getMTimeInternal(t) {
    const e = this.getLastModified(this.resolvePath(t));
    if (e)
      return new Date(e);
  }
  getMTime(t) {
    if (t.startsWith("/@memory/"))
      return this.mTimes.has(t) ? this.mTimes.get(t) : void 0;
    if (!this.fullyCached)
      return this.getMTimeInternal(t);
    if (this.mTimes.has(t))
      return this.mTimes.get(t);
    const e = this.getMTimeInternal(t);
    return this.mTimes.set(t, e), e;
  }
  // todo: isFile
  isFile() {
    return !0;
  }
  // todo: getRealPath
  getRealPath(t) {
    return t;
  }
  readAllInternal(t) {
    const e = new XMLHttpRequest();
    if (e.overrideMimeType("text/plain; charset=x-user-defined"), e.open("GET", this.resolvePath(t), !1), e.send(null), e.status === 200 && (e.response instanceof String || typeof e.response == "string"))
      return Uint8Array.from(e.response, (r) => r.charCodeAt(0));
  }
  readAll(t) {
    if (t.startsWith("/@memory/"))
      return this.mData.has(t) ? this.mData.get(t) : void 0;
    if (!this.fullyCached)
      return this.readAllInternal(t);
    if (this.mData.has(t))
      return this.mData.get(t);
    const e = this.readAllInternal(t);
    return this.mData.set(t, e), e;
  }
}
class dn {
  constructor() {
    p(this, "mTimes", /* @__PURE__ */ new Map());
    p(this, "mData", /* @__PURE__ */ new Map());
  }
  reset() {
    this.mTimes.clear(), this.mData.clear();
  }
  insertFile(t, e, r) {
    this.mTimes.set(t, r), this.mData.set(t, e);
  }
  removeFile(t) {
    this.mTimes.delete(t), this.mData.delete(t);
  }
  getMTime(t) {
    if (t.startsWith("/@memory/") && this.mTimes.has(t))
      return this.mTimes.get(t);
  }
  isFile() {
    return !0;
  }
  getRealPath(t) {
    return t;
  }
  readAll(t) {
    if (t.startsWith("/@memory/") && this.mData.has(t))
      return this.mData.get(t);
  }
}
class gn {
  constructor(t) {
    p(this, "cache", /* @__PURE__ */ new Map());
    this.am = t;
  }
  resolvePath(t) {
    return `https://packages.typst.org/preview/${t.name}-${t.version}.tar.gz`;
  }
  pullPackageData(t) {
    const e = new XMLHttpRequest();
    if (e.overrideMimeType("text/plain; charset=x-user-defined"), e.open("GET", this.resolvePath(t), !1), e.send(null), e.status === 200 && (e.response instanceof String || typeof e.response == "string"))
      return Uint8Array.from(e.response, (r) => r.charCodeAt(0));
  }
  resolve(t, e) {
    if (t.namespace !== "preview")
      return;
    const r = this.resolvePath(t);
    if (this.cache.has(r))
      return this.cache.get(r)();
    const i = this.pullPackageData(t);
    if (!i)
      return;
    const o = `/@memory/fetch/packages/preview/${t.namespace}/${t.name}/${t.version}`, s = [];
    e.untar(i, (d, g, w) => {
      s.push([o + "/" + d, g, new Date(w)]);
    });
    const c = () => {
      for (const [d, g, w] of s)
        this.am.insertFile(d, g, w);
      return o;
    };
    return this.cache.set(r, c), c();
  }
}
typeof window < "u" && (window.TypstRenderModule = {
  RenderView: se,
  createTypstRenderer: jt,
  createTypstSvgRenderer: jt,
  preloadRemoteFonts: St,
  preloadSystemFonts: Ot
}, window.TypstCompileModule = {
  createTypstCompiler: ge,
  preloadRemoteFonts: St,
  preloadSystemFonts: Ot,
  FetchAccessModel: un,
  MemoryAccessModel: dn,
  FetchPackageRegistry: gn,
  withAccessModel: Be,
  withPackageRegistry: We
});
let _;
const N = new Array(128).fill(void 0);
N.push(void 0, null, !0, !1);
function a(n) {
  return N[n];
}
let K = N.length;
function m(n) {
  K === N.length && N.push(N.length + 1);
  const t = K;
  if (K = N[t], typeof K != "number") throw new Error("corrupt heap");
  return N[t] = n, t;
}
function I(n, t) {
  try {
    return n.apply(this, t);
  } catch (e) {
    _.__wbindgen_export_0(m(e));
  }
}
function f(n, t) {
  try {
    return n.apply(this, t);
  } catch (e) {
    let r = function() {
      try {
        return e instanceof Error ? `${e.message}

Stack:
${e.stack}` : e.toString();
      } catch {
        return "<failed to stringify thrown value>";
      }
    }();
    throw console.error("wasm-bindgen: imported JS function that was not marked as `catch` threw an error:", r), e;
  }
}
function l(n) {
  if (typeof n != "number") throw new Error(`expected a number argument, found ${typeof n}`);
}
const fe = typeof TextDecoder < "u" ? new TextDecoder("utf-8", { ignoreBOM: !0, fatal: !0 }) : { decode: () => {
  throw Error("TextDecoder not available");
} };
typeof TextDecoder < "u" && fe.decode();
let Q = null;
function et() {
  return (Q === null || Q.byteLength === 0) && (Q = new Uint8Array(_.memory.buffer)), Q;
}
function k(n, t) {
  return n = n >>> 0, fe.decode(et().subarray(n, n + t));
}
let P = 0;
const _t = typeof TextEncoder < "u" ? new TextEncoder("utf-8") : { encode: () => {
  throw Error("TextEncoder not available");
} }, fn = typeof _t.encodeInto == "function" ? function(n, t) {
  return _t.encodeInto(n, t);
} : function(n, t) {
  const e = _t.encode(n);
  return t.set(e), {
    read: n.length,
    written: e.length
  };
};
function F(n, t, e) {
  if (typeof n != "string") throw new Error(`expected a string argument, found ${typeof n}`);
  if (e === void 0) {
    const c = _t.encode(n), d = t(c.length, 1) >>> 0;
    return et().subarray(d, d + c.length).set(c), P = c.length, d;
  }
  let r = n.length, i = t(r, 1) >>> 0;
  const o = et();
  let s = 0;
  for (; s < r; s++) {
    const c = n.charCodeAt(s);
    if (c > 127) break;
    o[i + s] = c;
  }
  if (s !== r) {
    s !== 0 && (n = n.slice(s)), i = e(i, r, r = s + n.length * 3, 1) >>> 0;
    const c = et().subarray(i + s, i + r), d = fn(n, c);
    if (d.read !== n.length) throw new Error("failed to pass whole string");
    s += d.written, i = e(i, r, s, 1) >>> 0;
  }
  return P = s, i;
}
let V = null;
function h() {
  return (V === null || V.buffer.detached === !0 || V.buffer.detached === void 0 && V.buffer !== _.memory.buffer) && (V = new DataView(_.memory.buffer)), V;
}
function A(n) {
  return n == null;
}
function L(n) {
  if (typeof n != "boolean")
    throw new Error(`expected a boolean argument, found ${typeof n}`);
}
function wn(n) {
  n < 132 || (N[n] = K, K = n);
}
function R(n) {
  const t = a(n);
  return wn(n), t;
}
const ut = typeof FinalizationRegistry > "u" ? { register: () => {
}, unregister: () => {
} } : new FinalizationRegistry((n) => {
  _.__wbindgen_export_4.get(n.dtor)(n.a, n.b);
});
function ln(n, t, e, r) {
  const i = { a: n, b: t, cnt: 1, dtor: e }, o = (...s) => {
    i.cnt++;
    const c = i.a;
    i.a = 0;
    try {
      return r(c, i.b, ...s);
    } finally {
      --i.cnt === 0 ? (_.__wbindgen_export_4.get(i.dtor)(c, i.b), ut.unregister(i)) : i.a = c;
    }
  };
  return o.original = i, ut.register(o, i, i), o;
}
function zt(n, t, e, r) {
  const i = { a: n, b: t, cnt: 1, dtor: e }, o = (...s) => {
    i.cnt++;
    try {
      return r(i.a, i.b, ...s);
    } finally {
      --i.cnt === 0 && (_.__wbindgen_export_4.get(i.dtor)(i.a, i.b), i.a = 0, ut.unregister(i));
    }
  };
  return o.original = i, ut.register(o, i, i), o;
}
function Ct(n) {
  const t = typeof n;
  if (t == "number" || t == "boolean" || n == null)
    return `${n}`;
  if (t == "string")
    return `"${n}"`;
  if (t == "symbol") {
    const i = n.description;
    return i == null ? "Symbol" : `Symbol(${i})`;
  }
  if (t == "function") {
    const i = n.name;
    return typeof i == "string" && i.length > 0 ? `Function(${i})` : "Function";
  }
  if (Array.isArray(n)) {
    const i = n.length;
    let o = "[";
    i > 0 && (o += Ct(n[0]));
    for (let s = 1; s < i; s++)
      o += ", " + Ct(n[s]);
    return o += "]", o;
  }
  const e = /\[object ([^\]]+)\]/.exec(toString.call(n));
  let r;
  if (e && e.length > 1)
    r = e[1];
  else
    return toString.call(n);
  if (r == "Object")
    try {
      return "Object(" + JSON.stringify(n) + ")";
    } catch {
      return "Object";
    }
  return n instanceof Error ? `${n.name}: ${n.message}
${n.stack}` : r;
}
function dt(n, t) {
  const e = t(n.length * 1, 1) >>> 0;
  return et().set(n, e / 1), P = n.length, e;
}
let Y = null;
function bn() {
  return (Y === null || Y.byteLength === 0) && (Y = new Uint32Array(_.memory.buffer)), Y;
}
function pn(n, t) {
  const e = t(n.length * 4, 4) >>> 0;
  return bn().set(n, e / 4), P = n.length, e;
}
function Ut(n, t) {
  const e = t(n.length * 4, 4) >>> 0, r = h();
  for (let i = 0; i < n.length; i++)
    r.setUint32(e + 4 * i, m(n[i]), !0);
  return P = n.length, e;
}
function U(n, t) {
  if (!(n instanceof t))
    throw new Error(`expected instance of ${t.name}`);
}
function hn() {
  const n = _.renderer_build_info();
  return R(n);
}
function mn(n, t, e) {
  l(n), l(t), _.__wbindgen_export_5(n, t, m(e));
}
function yn(n, t) {
  l(n), l(t), _.__wbindgen_export_6(n, t);
}
function vn(n, t, e) {
  l(n), l(t), _.__wbindgen_export_7(n, t, m(e));
}
function xn(n, t, e, r) {
  l(n), l(t), _.__wbindgen_export_8(n, t, m(e), m(r));
}
const qt = ["nonzero", "evenodd"], Nt = typeof FinalizationRegistry > "u" ? { register: () => {
}, unregister: () => {
} } : new FinalizationRegistry((n) => _.__wbg_createsessionoptions_free(n >>> 0, 1));
class we {
  __destroy_into_raw() {
    const t = this.__wbg_ptr;
    return this.__wbg_ptr = 0, Nt.unregister(this), t;
  }
  free() {
    const t = this.__destroy_into_raw();
    _.__wbg_createsessionoptions_free(t, 0);
  }
  constructor() {
    const t = _.createsessionoptions_new();
    return this.__wbg_ptr = t >>> 0, Nt.register(this, this.__wbg_ptr, this), this;
  }
  /**
   * @param {string} format
   */
  set format(t) {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    l(this.__wbg_ptr);
    const e = F(t, _.__wbindgen_export_1, _.__wbindgen_export_2), r = P;
    _.createsessionoptions_set_format(this.__wbg_ptr, e, r);
  }
  /**
   * @param {Uint8Array} artifact_content
   */
  set artifact_content(t) {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    l(this.__wbg_ptr);
    const e = dt(t, _.__wbindgen_export_1), r = P;
    _.createsessionoptions_set_artifact_content(this.__wbg_ptr, e, r);
  }
}
const Ht = typeof FinalizationRegistry > "u" ? { register: () => {
}, unregister: () => {
} } : new FinalizationRegistry((n) => _.__wbg_incrdomdocclient_free(n >>> 0, 1));
class ft {
  constructor() {
    throw new Error("cannot invoke `new` directly");
  }
  static __wrap(t) {
    t = t >>> 0;
    const e = Object.create(ft.prototype);
    return e.__wbg_ptr = t, Ht.register(e, e.__wbg_ptr, e), e;
  }
  __destroy_into_raw() {
    const t = this.__wbg_ptr;
    return this.__wbg_ptr = 0, Ht.unregister(this), t;
  }
  free() {
    const t = this.__destroy_into_raw();
    _.__wbg_incrdomdocclient_free(t, 0);
  }
  /**
   * @param {any} functions
   */
  bind_functions(t) {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    l(this.__wbg_ptr), _.incrdomdocclient_bind_functions(this.__wbg_ptr, m(t));
  }
  /**
   * Relayout the document in the given window.
   * @param {number} x
   * @param {number} y
   * @param {number} w
   * @param {number} h
   * @returns {Promise<boolean>}
   */
  relayout(t, e, r, i) {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    l(this.__wbg_ptr);
    const o = _.incrdomdocclient_relayout(this.__wbg_ptr, t, e, r, i);
    return R(o);
  }
  /**
   * @param {number} page_num
   * @param {number} x
   * @param {number} y
   * @param {number} w
   * @param {number} h
   * @param {number} stage
   * @returns {boolean}
   */
  need_repaint(t, e, r, i, o, s) {
    try {
      if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
      const w = _.__wbindgen_add_to_stack_pointer(-16);
      l(this.__wbg_ptr), l(t), l(s), _.incrdomdocclient_need_repaint(w, this.__wbg_ptr, t, e, r, i, o, s);
      var c = h().getInt32(w + 4 * 0, !0), d = h().getInt32(w + 4 * 1, !0), g = h().getInt32(w + 4 * 2, !0);
      if (g)
        throw R(d);
      return c !== 0;
    } finally {
      _.__wbindgen_add_to_stack_pointer(16);
    }
  }
  /**
   * @param {number} page_num
   * @param {number} x
   * @param {number} y
   * @param {number} w
   * @param {number} h
   * @param {number} stage
   * @returns {any}
   */
  repaint(t, e, r, i, o, s) {
    try {
      if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
      const w = _.__wbindgen_add_to_stack_pointer(-16);
      l(this.__wbg_ptr), l(t), l(s), _.incrdomdocclient_repaint(w, this.__wbg_ptr, t, e, r, i, o, s);
      var c = h().getInt32(w + 4 * 0, !0), d = h().getInt32(w + 4 * 1, !0), g = h().getInt32(w + 4 * 2, !0);
      if (g)
        throw R(d);
      return R(c);
    } finally {
      _.__wbindgen_add_to_stack_pointer(16);
    }
  }
}
const Vt = typeof FinalizationRegistry > "u" ? { register: () => {
}, unregister: () => {
} } : new FinalizationRegistry((n) => _.__wbg_pageinfo_free(n >>> 0, 1));
class rt {
  constructor() {
    throw new Error("cannot invoke `new` directly");
  }
  static __wrap(t) {
    t = t >>> 0;
    const e = Object.create(rt.prototype);
    return e.__wbg_ptr = t, Vt.register(e, e.__wbg_ptr, e), e;
  }
  __destroy_into_raw() {
    const t = this.__wbg_ptr;
    return this.__wbg_ptr = 0, Vt.unregister(this), t;
  }
  free() {
    const t = this.__destroy_into_raw();
    _.__wbg_pageinfo_free(t, 0);
  }
  /**
   * @returns {number}
   */
  get page_off() {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    return l(this.__wbg_ptr), _.pageinfo_page_off(this.__wbg_ptr) >>> 0;
  }
  /**
   * @returns {number}
   */
  get width_pt() {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    return l(this.__wbg_ptr), _.pageinfo_width_pt(this.__wbg_ptr);
  }
  /**
   * @returns {number}
   */
  get height_pt() {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    return l(this.__wbg_ptr), _.pageinfo_height_pt(this.__wbg_ptr);
  }
}
const Jt = typeof FinalizationRegistry > "u" ? { register: () => {
}, unregister: () => {
} } : new FinalizationRegistry((n) => _.__wbg_pagesinfo_free(n >>> 0, 1));
class wt {
  constructor() {
    throw new Error("cannot invoke `new` directly");
  }
  static __wrap(t) {
    t = t >>> 0;
    const e = Object.create(wt.prototype);
    return e.__wbg_ptr = t, Jt.register(e, e.__wbg_ptr, e), e;
  }
  __destroy_into_raw() {
    const t = this.__wbg_ptr;
    return this.__wbg_ptr = 0, Jt.unregister(this), t;
  }
  free() {
    const t = this.__destroy_into_raw();
    _.__wbg_pagesinfo_free(t, 0);
  }
  /**
   * @returns {number}
   */
  get page_count() {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    return l(this.__wbg_ptr), _.pagesinfo_page_count(this.__wbg_ptr) >>> 0;
  }
  /**
   * @param {number} num
   * @returns {PageInfo | undefined}
   */
  page_by_number(t) {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    l(this.__wbg_ptr), l(t);
    const e = _.pagesinfo_page_by_number(this.__wbg_ptr, t);
    return e === 0 ? void 0 : rt.__wrap(e);
  }
  /**
   * @param {number} i
   * @returns {PageInfo}
   */
  page(t) {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    l(this.__wbg_ptr), l(t);
    const e = _.pagesinfo_page(this.__wbg_ptr, t);
    return rt.__wrap(e);
  }
  /**
   * @returns {number}
   */
  width() {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    return l(this.__wbg_ptr), _.pagesinfo_width(this.__wbg_ptr);
  }
  /**
   * @returns {number}
   */
  height() {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    return l(this.__wbg_ptr), _.pagesinfo_height(this.__wbg_ptr);
  }
}
const Gt = typeof FinalizationRegistry > "u" ? { register: () => {
}, unregister: () => {
} } : new FinalizationRegistry((n) => _.__wbg_renderpageimageoptions_free(n >>> 0, 1));
class ot {
  static __unwrap(t) {
    return t instanceof ot ? t.__destroy_into_raw() : 0;
  }
  __destroy_into_raw() {
    const t = this.__wbg_ptr;
    return this.__wbg_ptr = 0, Gt.unregister(this), t;
  }
  free() {
    const t = this.__destroy_into_raw();
    _.__wbg_renderpageimageoptions_free(t, 0);
  }
  constructor() {
    const t = _.renderpageimageoptions_new();
    return this.__wbg_ptr = t >>> 0, Gt.register(this, this.__wbg_ptr, this), this;
  }
  /**
   * @returns {number | undefined}
   */
  get pixel_per_pt() {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    l(this.__wbg_ptr);
    const t = _.renderpageimageoptions_pixel_per_pt(this.__wbg_ptr);
    return t === 4294967297 ? void 0 : t;
  }
  /**
   * @param {number | null} [pixel_per_pt]
   */
  set pixel_per_pt(t) {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    l(this.__wbg_ptr), A(t) || l(t), _.renderpageimageoptions_set_pixel_per_pt(this.__wbg_ptr, A(t) ? 4294967297 : Math.fround(t));
  }
  /**
   * @returns {string | undefined}
   */
  get background_color() {
    try {
      if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
      const r = _.__wbindgen_add_to_stack_pointer(-16);
      l(this.__wbg_ptr), _.renderpageimageoptions_background_color(r, this.__wbg_ptr);
      var t = h().getInt32(r + 4 * 0, !0), e = h().getInt32(r + 4 * 1, !0);
      let i;
      return t !== 0 && (i = k(t, e).slice(), _.__wbindgen_export_3(t, e * 1, 1)), i;
    } finally {
      _.__wbindgen_add_to_stack_pointer(16);
    }
  }
  /**
   * @param {string | null} [background_color]
   */
  set background_color(t) {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    l(this.__wbg_ptr);
    var e = A(t) ? 0 : F(t, _.__wbindgen_export_1, _.__wbindgen_export_2), r = P;
    _.renderpageimageoptions_set_background_color(this.__wbg_ptr, e, r);
  }
  /**
   * @returns {number}
   */
  get page_off() {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    return l(this.__wbg_ptr), _.renderpageimageoptions_page_off(this.__wbg_ptr) >>> 0;
  }
  /**
   * @param {number} page_off
   */
  set page_off(t) {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    l(this.__wbg_ptr), l(t), _.renderpageimageoptions_set_page_off(this.__wbg_ptr, t);
  }
  /**
   * @returns {string | undefined}
   */
  get cache_key() {
    try {
      if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
      const r = _.__wbindgen_add_to_stack_pointer(-16);
      l(this.__wbg_ptr), _.renderpageimageoptions_cache_key(r, this.__wbg_ptr);
      var t = h().getInt32(r + 4 * 0, !0), e = h().getInt32(r + 4 * 1, !0);
      let i;
      return t !== 0 && (i = k(t, e).slice(), _.__wbindgen_export_3(t, e * 1, 1)), i;
    } finally {
      _.__wbindgen_add_to_stack_pointer(16);
    }
  }
  /**
   * @param {string | null} [cache_key]
   */
  set cache_key(t) {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    l(this.__wbg_ptr);
    var e = A(t) ? 0 : F(t, _.__wbindgen_export_1, _.__wbindgen_export_2), r = P;
    _.renderpageimageoptions_set_cache_key(this.__wbg_ptr, e, r);
  }
  /**
   * @returns {number | undefined}
   */
  get data_selection() {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    l(this.__wbg_ptr);
    const t = _.renderpageimageoptions_data_selection(this.__wbg_ptr);
    return t === 4294967297 ? void 0 : t;
  }
  /**
   * @param {number | null} [data_selection]
   */
  set data_selection(t) {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    l(this.__wbg_ptr), A(t) || l(t), _.renderpageimageoptions_set_data_selection(this.__wbg_ptr, A(t) ? 4294967297 : t >>> 0);
  }
}
const Kt = typeof FinalizationRegistry > "u" ? { register: () => {
}, unregister: () => {
} } : new FinalizationRegistry((n) => _.__wbg_rendersession_free(n >>> 0, 1));
class W {
  constructor() {
    throw new Error("cannot invoke `new` directly");
  }
  static __wrap(t) {
    t = t >>> 0;
    const e = Object.create(W.prototype);
    return e.__wbg_ptr = t, Kt.register(e, e.__wbg_ptr, e), e;
  }
  __destroy_into_raw() {
    const t = this.__wbg_ptr;
    return this.__wbg_ptr = 0, Kt.unregister(this), t;
  }
  free() {
    const t = this.__destroy_into_raw();
    _.__wbg_rendersession_free(t, 0);
  }
  /**
   * @returns {number | undefined}
   */
  get pixel_per_pt() {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    l(this.__wbg_ptr);
    const t = _.rendersession_pixel_per_pt(this.__wbg_ptr);
    return t === 4294967297 ? void 0 : t;
  }
  /**
   * @param {number | null} [pixel_per_pt]
   */
  set pixel_per_pt(t) {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    l(this.__wbg_ptr), A(t) || l(t), _.rendersession_set_pixel_per_pt(this.__wbg_ptr, A(t) ? 4294967297 : Math.fround(t));
  }
  /**
   * @returns {string | undefined}
   */
  get background_color() {
    try {
      if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
      const r = _.__wbindgen_add_to_stack_pointer(-16);
      l(this.__wbg_ptr), _.rendersession_background_color(r, this.__wbg_ptr);
      var t = h().getInt32(r + 4 * 0, !0), e = h().getInt32(r + 4 * 1, !0);
      let i;
      return t !== 0 && (i = k(t, e).slice(), _.__wbindgen_export_3(t, e * 1, 1)), i;
    } finally {
      _.__wbindgen_add_to_stack_pointer(16);
    }
  }
  /**
   * @param {string | null} [background_color]
   */
  set background_color(t) {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    l(this.__wbg_ptr);
    var e = A(t) ? 0 : F(t, _.__wbindgen_export_1, _.__wbindgen_export_2), r = P;
    _.rendersession_set_background_color(this.__wbg_ptr, e, r);
  }
  /**
   * @returns {PagesInfo}
   */
  get pages_info() {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    l(this.__wbg_ptr);
    const t = _.rendersession_pages_info(this.__wbg_ptr);
    return wt.__wrap(t);
  }
  /**
   * @returns {number}
   */
  get doc_width() {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    return l(this.__wbg_ptr), _.rendersession_doc_width(this.__wbg_ptr);
  }
  /**
   * @returns {number}
   */
  get doc_height() {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    return l(this.__wbg_ptr), _.rendersession_doc_height(this.__wbg_ptr);
  }
  /**
   * @param {Uint32Array} path
   * @returns {string | undefined}
   */
  source_span(t) {
    try {
      if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
      const s = _.__wbindgen_add_to_stack_pointer(-16);
      l(this.__wbg_ptr);
      const c = pn(t, _.__wbindgen_export_1), d = P;
      _.rendersession_source_span(s, this.__wbg_ptr, c, d);
      var e = h().getInt32(s + 4 * 0, !0), r = h().getInt32(s + 4 * 1, !0), i = h().getInt32(s + 4 * 2, !0), o = h().getInt32(s + 4 * 3, !0);
      if (o)
        throw R(i);
      let g;
      return e !== 0 && (g = k(e, r).slice(), _.__wbindgen_export_3(e, r * 1, 1)), g;
    } finally {
      _.__wbindgen_add_to_stack_pointer(16);
    }
  }
  /**
   * @param {number} rect_lo_x
   * @param {number} rect_lo_y
   * @param {number} rect_hi_x
   * @param {number} rect_hi_y
   * @returns {string}
   */
  render_in_window(t, e, r, i) {
    let o, s;
    try {
      if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
      const g = _.__wbindgen_add_to_stack_pointer(-16);
      l(this.__wbg_ptr), _.rendersession_render_in_window(g, this.__wbg_ptr, t, e, r, i);
      var c = h().getInt32(g + 4 * 0, !0), d = h().getInt32(g + 4 * 1, !0);
      return o = c, s = d, k(c, d);
    } finally {
      _.__wbindgen_add_to_stack_pointer(16), _.__wbindgen_export_3(o, s, 1);
    }
  }
}
const Xt = typeof FinalizationRegistry > "u" ? { register: () => {
}, unregister: () => {
} } : new FinalizationRegistry((n) => _.__wbg_rendersessionoptions_free(n >>> 0, 1));
class In {
  __destroy_into_raw() {
    const t = this.__wbg_ptr;
    return this.__wbg_ptr = 0, Xt.unregister(this), t;
  }
  free() {
    const t = this.__destroy_into_raw();
    _.__wbg_rendersessionoptions_free(t, 0);
  }
  constructor() {
    const t = _.rendersessionoptions_new();
    return this.__wbg_ptr = t >>> 0, Xt.register(this, this.__wbg_ptr, this), this;
  }
  /**
   * @returns {number | undefined}
   */
  get pixel_per_pt() {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    l(this.__wbg_ptr);
    const t = _.rendersession_pixel_per_pt(this.__wbg_ptr);
    return t === 4294967297 ? void 0 : t;
  }
  /**
   * @param {number | null} [pixel_per_pt]
   */
  set pixel_per_pt(t) {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    l(this.__wbg_ptr), A(t) || l(t), _.rendersession_set_pixel_per_pt(this.__wbg_ptr, A(t) ? 4294967297 : Math.fround(t));
  }
  /**
   * @returns {string | undefined}
   */
  get background_color() {
    try {
      if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
      const r = _.__wbindgen_add_to_stack_pointer(-16);
      l(this.__wbg_ptr), _.rendersessionoptions_background_color(r, this.__wbg_ptr);
      var t = h().getInt32(r + 4 * 0, !0), e = h().getInt32(r + 4 * 1, !0);
      let i;
      return t !== 0 && (i = k(t, e).slice(), _.__wbindgen_export_3(t, e * 1, 1)), i;
    } finally {
      _.__wbindgen_add_to_stack_pointer(16);
    }
  }
  /**
   * @param {string | null} [background_color]
   */
  set background_color(t) {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    l(this.__wbg_ptr);
    var e = A(t) ? 0 : F(t, _.__wbindgen_export_1, _.__wbindgen_export_2), r = P;
    _.rendersessionoptions_set_background_color(this.__wbg_ptr, e, r);
  }
  /**
   * @returns {string | undefined}
   */
  get format() {
    try {
      if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
      const r = _.__wbindgen_add_to_stack_pointer(-16);
      l(this.__wbg_ptr), _.rendersessionoptions_format(r, this.__wbg_ptr);
      var t = h().getInt32(r + 4 * 0, !0), e = h().getInt32(r + 4 * 1, !0);
      let i;
      return t !== 0 && (i = k(t, e).slice(), _.__wbindgen_export_3(t, e * 1, 1)), i;
    } finally {
      _.__wbindgen_add_to_stack_pointer(16);
    }
  }
  /**
   * @param {string | null} [format]
   */
  set format(t) {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    l(this.__wbg_ptr);
    var e = A(t) ? 0 : F(t, _.__wbindgen_export_1, _.__wbindgen_export_2), r = P;
    _.rendersessionoptions_set_format(this.__wbg_ptr, e, r);
  }
}
const kt = typeof FinalizationRegistry > "u" ? { register: () => {
}, unregister: () => {
} } : new FinalizationRegistry((n) => _.__wbg_typstrenderer_free(n >>> 0, 1));
class lt {
  static __wrap(t) {
    t = t >>> 0;
    const e = Object.create(lt.prototype);
    return e.__wbg_ptr = t, kt.register(e, e.__wbg_ptr, e), e;
  }
  __destroy_into_raw() {
    const t = this.__wbg_ptr;
    return this.__wbg_ptr = 0, kt.unregister(this), t;
  }
  free() {
    const t = this.__destroy_into_raw();
    _.__wbg_typstrenderer_free(t, 0);
  }
  /**
   * @param {any} _w
   * @returns {Promise<TypstWorker>}
   */
  create_worker(t) {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    l(this.__wbg_ptr);
    const e = _.typstrenderer_create_worker(this.__wbg_ptr, m(t));
    return R(e);
  }
  /**
   * @returns {WorkerBridge}
   */
  create_worker_bridge() {
    try {
      if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
      const i = this.__destroy_into_raw(), o = _.__wbindgen_add_to_stack_pointer(-16);
      l(i), _.typstrenderer_create_worker_bridge(o, i);
      var t = h().getInt32(o + 4 * 0, !0), e = h().getInt32(o + 4 * 1, !0), r = h().getInt32(o + 4 * 2, !0);
      if (r)
        throw R(e);
      return bt.__wrap(t);
    } finally {
      _.__wbindgen_add_to_stack_pointer(16);
    }
  }
  /**
   * @param {RenderSession} ses
   * @param {HTMLElement} elem
   * @returns {Promise<IncrDomDocClient>}
   */
  mount_dom(t, e) {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    if (l(this.__wbg_ptr), U(t, W), t.__wbg_ptr === 0)
      throw new Error("Attempt to use a moved value");
    const r = _.typstrenderer_mount_dom(this.__wbg_ptr, t.__wbg_ptr, m(e));
    return R(r);
  }
  /**
   * @param {any} _v
   */
  load_glyph_pack(t) {
    try {
      if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
      const i = _.__wbindgen_add_to_stack_pointer(-16);
      l(this.__wbg_ptr), _.typstrenderer_load_glyph_pack(i, this.__wbg_ptr, m(t));
      var e = h().getInt32(i + 4 * 0, !0), r = h().getInt32(i + 4 * 1, !0);
      if (r)
        throw R(e);
    } finally {
      _.__wbindgen_add_to_stack_pointer(16);
    }
  }
  /**
   * @param {RenderSession} ses
   * @param {any} canvas
   * @param {RenderPageImageOptions | null} [options]
   * @returns {Promise<any>}
   */
  render_page_to_canvas(t, e, r) {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    if (l(this.__wbg_ptr), U(t, W), t.__wbg_ptr === 0)
      throw new Error("Attempt to use a moved value");
    let i = 0;
    if (!A(r)) {
      if (U(r, ot), r.__wbg_ptr === 0)
        throw new Error("Attempt to use a moved value");
      i = r.__destroy_into_raw();
    }
    const o = _.typstrenderer_render_page_to_canvas(this.__wbg_ptr, t.__wbg_ptr, m(e), i);
    return R(o);
  }
  /**
   * @param {RenderSession} session
   * @param {number} rect_lo_x
   * @param {number} rect_lo_y
   * @param {number} rect_hi_x
   * @param {number} rect_hi_y
   * @returns {string}
   */
  render_svg_diff(t, e, r, i, o) {
    let s, c;
    try {
      if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
      const w = _.__wbindgen_add_to_stack_pointer(-16);
      if (l(this.__wbg_ptr), U(t, W), t.__wbg_ptr === 0)
        throw new Error("Attempt to use a moved value");
      _.typstrenderer_render_svg_diff(w, this.__wbg_ptr, t.__wbg_ptr, e, r, i, o);
      var d = h().getInt32(w + 4 * 0, !0), g = h().getInt32(w + 4 * 1, !0);
      return s = d, c = g, k(d, g);
    } finally {
      _.__wbindgen_add_to_stack_pointer(16), _.__wbindgen_export_3(s, c, 1);
    }
  }
  /**
   * @param {RenderSession} session
   * @param {number | null} [parts]
   * @returns {string}
   */
  svg_data(t, e) {
    let r, i;
    try {
      if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
      const v = _.__wbindgen_add_to_stack_pointer(-16);
      if (l(this.__wbg_ptr), U(t, W), t.__wbg_ptr === 0)
        throw new Error("Attempt to use a moved value");
      A(e) || l(e), _.typstrenderer_svg_data(v, this.__wbg_ptr, t.__wbg_ptr, A(e) ? 4294967297 : e >>> 0);
      var o = h().getInt32(v + 4 * 0, !0), s = h().getInt32(v + 4 * 1, !0), c = h().getInt32(v + 4 * 2, !0), d = h().getInt32(v + 4 * 3, !0), g = o, w = s;
      if (d)
        throw g = 0, w = 0, R(c);
      return r = g, i = w, k(g, w);
    } finally {
      _.__wbindgen_add_to_stack_pointer(16), _.__wbindgen_export_3(r, i, 1);
    }
  }
  /**
   * @param {RenderSession} session
   * @returns {Array<any> | undefined}
   */
  get_customs(t) {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    if (l(this.__wbg_ptr), U(t, W), t.__wbg_ptr === 0)
      throw new Error("Attempt to use a moved value");
    const e = _.typstrenderer_get_customs(this.__wbg_ptr, t.__wbg_ptr);
    return R(e);
  }
  /**
   * @param {RenderSession} session
   * @param {HTMLElement} root
   * @returns {boolean}
   */
  render_svg(t, e) {
    try {
      if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
      const s = _.__wbindgen_add_to_stack_pointer(-16);
      if (l(this.__wbg_ptr), U(t, W), t.__wbg_ptr === 0)
        throw new Error("Attempt to use a moved value");
      _.typstrenderer_render_svg(s, this.__wbg_ptr, t.__wbg_ptr, m(e));
      var r = h().getInt32(s + 4 * 0, !0), i = h().getInt32(s + 4 * 1, !0), o = h().getInt32(s + 4 * 2, !0);
      if (o)
        throw R(i);
      return r !== 0;
    } finally {
      _.__wbindgen_add_to_stack_pointer(16);
    }
  }
  constructor() {
    const t = _.typstrenderer_new();
    return this.__wbg_ptr = t >>> 0, kt.register(this, this.__wbg_ptr, this), this;
  }
  /**
   * @param {CreateSessionOptions | null} [options]
   * @returns {RenderSession}
   */
  create_session(t) {
    try {
      if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
      const o = _.__wbindgen_add_to_stack_pointer(-16);
      l(this.__wbg_ptr);
      let s = 0;
      if (!A(t)) {
        if (U(t, we), t.__wbg_ptr === 0)
          throw new Error("Attempt to use a moved value");
        s = t.__destroy_into_raw();
      }
      _.typstrenderer_create_session(o, this.__wbg_ptr, s);
      var e = h().getInt32(o + 4 * 0, !0), r = h().getInt32(o + 4 * 1, !0), i = h().getInt32(o + 4 * 2, !0);
      if (i)
        throw R(r);
      return W.__wrap(e);
    } finally {
      _.__wbindgen_add_to_stack_pointer(16);
    }
  }
  /**
   * @param {RenderSession} session
   */
  reset(t) {
    try {
      if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
      const i = _.__wbindgen_add_to_stack_pointer(-16);
      if (l(this.__wbg_ptr), U(t, W), t.__wbg_ptr === 0)
        throw new Error("Attempt to use a moved value");
      _.typstrenderer_reset(i, this.__wbg_ptr, t.__wbg_ptr);
      var e = h().getInt32(i + 4 * 0, !0), r = h().getInt32(i + 4 * 1, !0);
      if (r)
        throw R(e);
    } finally {
      _.__wbindgen_add_to_stack_pointer(16);
    }
  }
  /**
   * @param {RenderSession} session
   * @param {string} action
   * @param {Uint8Array} data
   */
  manipulate_data(t, e, r) {
    try {
      if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
      const s = _.__wbindgen_add_to_stack_pointer(-16);
      if (l(this.__wbg_ptr), U(t, W), t.__wbg_ptr === 0)
        throw new Error("Attempt to use a moved value");
      const c = F(e, _.__wbindgen_export_1, _.__wbindgen_export_2), d = P, g = dt(r, _.__wbindgen_export_1), w = P;
      _.typstrenderer_manipulate_data(s, this.__wbg_ptr, t.__wbg_ptr, c, d, g, w);
      var i = h().getInt32(s + 4 * 0, !0), o = h().getInt32(s + 4 * 1, !0);
      if (o)
        throw R(i);
    } finally {
      _.__wbindgen_add_to_stack_pointer(16);
    }
  }
  /**
   * @param {Uint8Array} artifact_content
   * @param {string} decoder
   * @returns {RenderSession}
   */
  session_from_artifact(t, e) {
    try {
      if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
      const s = _.__wbindgen_add_to_stack_pointer(-16);
      l(this.__wbg_ptr);
      const c = dt(t, _.__wbindgen_export_1), d = P, g = F(e, _.__wbindgen_export_1, _.__wbindgen_export_2), w = P;
      _.typstrenderer_session_from_artifact(s, this.__wbg_ptr, c, d, g, w);
      var r = h().getInt32(s + 4 * 0, !0), i = h().getInt32(s + 4 * 1, !0), o = h().getInt32(s + 4 * 2, !0);
      if (o)
        throw R(i);
      return W.__wrap(r);
    } finally {
      _.__wbindgen_add_to_stack_pointer(16);
    }
  }
}
const Qt = typeof FinalizationRegistry > "u" ? { register: () => {
}, unregister: () => {
} } : new FinalizationRegistry((n) => _.__wbg_typstrendererbuilder_free(n >>> 0, 1));
class kn {
  __destroy_into_raw() {
    const t = this.__wbg_ptr;
    return this.__wbg_ptr = 0, Qt.unregister(this), t;
  }
  free() {
    const t = this.__destroy_into_raw();
    _.__wbg_typstrendererbuilder_free(t, 0);
  }
  constructor() {
    try {
      const i = _.__wbindgen_add_to_stack_pointer(-16);
      _.typstrendererbuilder_new(i);
      var t = h().getInt32(i + 4 * 0, !0), e = h().getInt32(i + 4 * 1, !0), r = h().getInt32(i + 4 * 2, !0);
      if (r)
        throw R(e);
      return this.__wbg_ptr = t >>> 0, Qt.register(this, this.__wbg_ptr, this), this;
    } finally {
      _.__wbindgen_add_to_stack_pointer(16);
    }
  }
  /**
   * @returns {Promise<TypstRenderer>}
   */
  build() {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    const t = this.__destroy_into_raw();
    l(t);
    const e = _.typstrendererbuilder_build(t);
    return R(e);
  }
  /**
   * @param {any} _pack
   * @returns {Promise<void>}
   */
  add_glyph_pack(t) {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    l(this.__wbg_ptr);
    const e = _.typstrendererbuilder_add_glyph_pack(this.__wbg_ptr, m(t));
    return R(e);
  }
  /**
   * @param {Uint8Array} _font_buffer
   * @returns {Promise<void>}
   */
  add_raw_font(t) {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    l(this.__wbg_ptr);
    const e = _.typstrendererbuilder_add_raw_font(this.__wbg_ptr, m(t));
    return R(e);
  }
  /**
   * @param {Array<any>} _fonts
   * @returns {Promise<void>}
   */
  add_web_fonts(t) {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    l(this.__wbg_ptr);
    const e = _.typstrendererbuilder_add_web_fonts(this.__wbg_ptr, m(t));
    return R(e);
  }
}
const En = typeof FinalizationRegistry > "u" ? { register: () => {
}, unregister: () => {
} } : new FinalizationRegistry((n) => _.__wbg_typstworker_free(n >>> 0, 1));
class Sn {
  constructor() {
    throw new Error("cannot invoke `new` directly");
  }
  __destroy_into_raw() {
    const t = this.__wbg_ptr;
    return this.__wbg_ptr = 0, En.unregister(this), t;
  }
  free() {
    const t = this.__destroy_into_raw();
    _.__wbg_typstworker_free(t, 0);
  }
  /**
   * @param {string} _action
   * @param {Uint8Array} _data
   * @returns {Promise<any>}
   */
  manipulate_data(t, e) {
    try {
      if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
      const s = _.__wbindgen_add_to_stack_pointer(-16);
      l(this.__wbg_ptr);
      const c = F(t, _.__wbindgen_export_1, _.__wbindgen_export_2), d = P;
      _.typstworker_manipulate_data(s, this.__wbg_ptr, c, d, m(e));
      var r = h().getInt32(s + 4 * 0, !0), i = h().getInt32(s + 4 * 1, !0), o = h().getInt32(s + 4 * 2, !0);
      if (o)
        throw R(i);
      return R(r);
    } finally {
      _.__wbindgen_add_to_stack_pointer(16);
    }
  }
  /**
   * @returns {Promise<any>}
   */
  get_pages_info() {
    if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
    l(this.__wbg_ptr);
    const t = _.typstworker_get_pages_info(this.__wbg_ptr);
    return R(t);
  }
  /**
   * @param {Uint8Array} _actions
   * @param {HTMLCanvasElement[]} _canvas_list
   * @param {RenderPageImageOptions[]} _data
   * @returns {Promise<any>}
   */
  render_canvas(t, e, r) {
    try {
      if (this.__wbg_ptr == 0) throw new Error("Attempt to use a moved value");
      const c = _.__wbindgen_add_to_stack_pointer(-16);
      l(this.__wbg_ptr);
      const d = dt(t, _.__wbindgen_export_1), g = P, w = Ut(e, _.__wbindgen_export_1), v = P, T = Ut(r, _.__wbindgen_export_1), C = P;
      _.typstworker_render_canvas(c, this.__wbg_ptr, d, g, w, v, T, C);
      var i = h().getInt32(c + 4 * 0, !0), o = h().getInt32(c + 4 * 1, !0), s = h().getInt32(c + 4 * 2, !0);
      if (s)
        throw R(o);
      return R(i);
    } finally {
      _.__wbindgen_add_to_stack_pointer(16);
    }
  }
}
const Yt = typeof FinalizationRegistry > "u" ? { register: () => {
}, unregister: () => {
} } : new FinalizationRegistry((n) => _.__wbg_workerbridge_free(n >>> 0, 1));
class bt {
  constructor() {
    throw new Error("cannot invoke `new` directly");
  }
  static __wrap(t) {
    t = t >>> 0;
    const e = Object.create(bt.prototype);
    return e.__wbg_ptr = t, Yt.register(e, e.__wbg_ptr, e), e;
  }
  __destroy_into_raw() {
    const t = this.__wbg_ptr;
    return this.__wbg_ptr = 0, Yt.unregister(this), t;
  }
  free() {
    const t = this.__destroy_into_raw();
    _.__wbg_workerbridge_free(t, 0);
  }
}
async function Rn(n, t) {
  if (typeof Response == "function" && n instanceof Response) {
    if (typeof WebAssembly.instantiateStreaming == "function")
      try {
        return await WebAssembly.instantiateStreaming(n, t);
      } catch (r) {
        if (n.headers.get("Content-Type") != "application/wasm")
          console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n", r);
        else
          throw r;
      }
    const e = await n.arrayBuffer();
    return await WebAssembly.instantiate(e, t);
  } else {
    const e = await WebAssembly.instantiate(n, t);
    return e instanceof WebAssembly.Instance ? { instance: e, module: n } : e;
  }
}
function le() {
  const n = {};
  return n.wbg = {}, n.wbg.__wbg_appendChild_8204974b7328bf98 = function() {
    return I(function(t, e) {
      const r = a(t).appendChild(a(e));
      return m(r);
    }, arguments);
  }, n.wbg.__wbg_buffer_609cc3eee51ed158 = function() {
    return f(function(t) {
      const e = a(t).buffer;
      return m(e);
    }, arguments);
  }, n.wbg.__wbg_call_672a4d21634d4a24 = function() {
    return I(function(t, e) {
      const r = a(t).call(a(e));
      return m(r);
    }, arguments);
  }, n.wbg.__wbg_call_7cccdd69e0791ae2 = function() {
    return I(function(t, e, r) {
      const i = a(t).call(a(e), a(r));
      return m(i);
    }, arguments);
  }, n.wbg.__wbg_call_833bed5770ea2041 = function() {
    return I(function(t, e, r, i) {
      const o = a(t).call(a(e), a(r), a(i));
      return m(o);
    }, arguments);
  }, n.wbg.__wbg_call_b8adc8b1d0a0d8eb = function() {
    return I(function(t, e, r, i, o) {
      const s = a(t).call(a(e), a(r), a(i), a(o));
      return m(s);
    }, arguments);
  }, n.wbg.__wbg_clearRect_8e4ba7ea0e06711a = function() {
    return f(function(t, e, r, i, o) {
      a(t).clearRect(e, r, i, o);
    }, arguments);
  }, n.wbg.__wbg_clientWidth_ce67a04dc15fce39 = function() {
    return f(function(t) {
      const e = a(t).clientWidth;
      return l(e), e;
    }, arguments);
  }, n.wbg.__wbg_clip_8e8cfb00a055cd03 = function() {
    return f(function(t, e) {
      a(t).clip(a(e));
    }, arguments);
  }, n.wbg.__wbg_clip_f584e320f8a2b022 = function() {
    return f(function(t, e) {
      a(t).clip(a(e));
    }, arguments);
  }, n.wbg.__wbg_cloneNode_e35b333b87d51340 = function() {
    return I(function(t) {
      const e = a(t).cloneNode();
      return m(e);
    }, arguments);
  }, n.wbg.__wbg_content_537e4105afcd9cee = function() {
    return f(function(t) {
      const e = a(t).content;
      return m(e);
    }, arguments);
  }, n.wbg.__wbg_createElement_8c9931a732ee2fea = function() {
    return I(function(t, e, r) {
      const i = a(t).createElement(k(e, r));
      return m(i);
    }, arguments);
  }, n.wbg.__wbg_createImageBitmap_705010fb21a22922 = function() {
    return I(function(t, e) {
      const r = a(t).createImageBitmap(a(e));
      return m(r);
    }, arguments);
  }, n.wbg.__wbg_createImageBitmap_b814e27800576bdb = function() {
    return I(function(t, e) {
      const r = a(t).createImageBitmap(a(e));
      return m(r);
    }, arguments);
  }, n.wbg.__wbg_createObjectURL_6e98d2f9c7bd9764 = function() {
    return I(function(t, e) {
      const r = URL.createObjectURL(a(e)), i = F(r, _.__wbindgen_export_1, _.__wbindgen_export_2), o = P;
      h().setInt32(t + 4 * 1, o, !0), h().setInt32(t + 4 * 0, i, !0);
    }, arguments);
  }, n.wbg.__wbg_document_d249400bd7bd996d = function() {
    return f(function(t) {
      const e = a(t).document;
      return A(e) ? 0 : m(e);
    }, arguments);
  }, n.wbg.__wbg_drawImage_0915f348c5d54848 = function() {
    return I(function(t, e, r, i) {
      a(t).drawImage(a(e), r, i);
    }, arguments);
  }, n.wbg.__wbg_drawImage_16485aae76d89dbf = function() {
    return I(function(t, e, r, i, o, s) {
      a(t).drawImage(a(e), r, i, o, s);
    }, arguments);
  }, n.wbg.__wbg_drawImage_468585e3ecfa189a = function() {
    return I(function(t, e, r, i, o, s) {
      a(t).drawImage(a(e), r, i, o, s);
    }, arguments);
  }, n.wbg.__wbg_drawImage_472a4d5b6df3739a = function() {
    return I(function(t, e, r, i) {
      a(t).drawImage(a(e), r, i);
    }, arguments);
  }, n.wbg.__wbg_drawImage_473e6602e24e18aa = function() {
    return I(function(t, e, r, i) {
      a(t).drawImage(a(e), r, i);
    }, arguments);
  }, n.wbg.__wbg_drawImage_86fd8465c00c7bc6 = function() {
    return I(function(t, e, r, i, o, s) {
      a(t).drawImage(a(e), r, i, o, s);
    }, arguments);
  }, n.wbg.__wbg_drawImage_ff273710b96c85cc = function() {
    return I(function(t, e, r, i, o, s) {
      a(t).drawImage(a(e), r, i, o, s);
    }, arguments);
  }, n.wbg.__wbg_error_7534b8e9a36f1ab4 = function() {
    return f(function(t, e) {
      let r, i;
      try {
        r = t, i = e, console.error(k(t, e));
      } finally {
        _.__wbindgen_export_3(r, i, 1);
      }
    }, arguments);
  }, n.wbg.__wbg_fillRect_b1529535ac758d4c = function() {
    return f(function(t, e, r, i, o) {
      a(t).fillRect(e, r, i, o);
    }, arguments);
  }, n.wbg.__wbg_fillRect_c38d5d56492a2368 = function() {
    return f(function(t, e, r, i, o) {
      a(t).fillRect(e, r, i, o);
    }, arguments);
  }, n.wbg.__wbg_fill_51814702df845abd = function() {
    return f(function(t, e, r) {
      a(t).fill(a(e), qt[r]);
    }, arguments);
  }, n.wbg.__wbg_fill_5d26765e6d1d8f6b = function() {
    return f(function(t, e) {
      a(t).fill(a(e));
    }, arguments);
  }, n.wbg.__wbg_fill_64902335a40baa8d = function() {
    return f(function(t, e, r) {
      a(t).fill(a(e), qt[r]);
    }, arguments);
  }, n.wbg.__wbg_fill_cbb22e6ac4da5b1b = function() {
    return f(function(t, e) {
      a(t).fill(a(e));
    }, arguments);
  }, n.wbg.__wbg_firstElementChild_21331181ca115bcc = function() {
    return f(function(t) {
      const e = a(t).firstElementChild;
      return A(e) ? 0 : m(e);
    }, arguments);
  }, n.wbg.__wbg_firstElementChild_d75d385f5abd1414 = function() {
    return f(function(t) {
      const e = a(t).firstElementChild;
      return A(e) ? 0 : m(e);
    }, arguments);
  }, n.wbg.__wbg_getAttribute_ea5166be2deba45e = function() {
    return f(function(t, e, r, i) {
      const o = a(e).getAttribute(k(r, i));
      var s = A(o) ? 0 : F(o, _.__wbindgen_export_1, _.__wbindgen_export_2), c = P;
      h().setInt32(t + 4 * 1, c, !0), h().setInt32(t + 4 * 0, s, !0);
    }, arguments);
  }, n.wbg.__wbg_getContext_e9cf379449413580 = function() {
    return I(function(t, e, r) {
      const i = a(t).getContext(k(e, r));
      return A(i) ? 0 : m(i);
    }, arguments);
  }, n.wbg.__wbg_getContext_f65a0debd1e8f8e8 = function() {
    return I(function(t, e, r) {
      const i = a(t).getContext(k(e, r));
      return A(i) ? 0 : m(i);
    }, arguments);
  }, n.wbg.__wbg_get_67b2ba62fc30de12 = function() {
    return I(function(t, e) {
      const r = Reflect.get(a(t), a(e));
      return m(r);
    }, arguments);
  }, n.wbg.__wbg_globalCompositeOperation_154b0f30008caa5e = function() {
    return I(function(t, e) {
      const r = a(e).globalCompositeOperation, i = F(r, _.__wbindgen_export_1, _.__wbindgen_export_2), o = P;
      h().setInt32(t + 4 * 1, o, !0), h().setInt32(t + 4 * 0, i, !0);
    }, arguments);
  }, n.wbg.__wbg_globalCompositeOperation_1f405e2ef7c5118b = function() {
    return I(function(t, e) {
      const r = a(e).globalCompositeOperation, i = F(r, _.__wbindgen_export_1, _.__wbindgen_export_2), o = P;
      h().setInt32(t + 4 * 1, o, !0), h().setInt32(t + 4 * 0, i, !0);
    }, arguments);
  }, n.wbg.__wbg_height_d3f39e12f0f62121 = function() {
    return f(function(t) {
      const e = a(t).height;
      return l(e), e;
    }, arguments);
  }, n.wbg.__wbg_incrdomdocclient_new = function() {
    return f(function(t) {
      const e = ft.__wrap(t);
      return m(e);
    }, arguments);
  }, n.wbg.__wbg_instanceof_CanvasRenderingContext2d_df82a4d3437bf1cc = function() {
    return f(function(t) {
      let e;
      try {
        e = a(t) instanceof CanvasRenderingContext2D;
      } catch {
        e = !1;
      }
      const r = e;
      return L(r), r;
    }, arguments);
  }, n.wbg.__wbg_instanceof_Element_0af65443936d5154 = function() {
    return f(function(t) {
      let e;
      try {
        e = a(t) instanceof Element;
      } catch {
        e = !1;
      }
      const r = e;
      return L(r), r;
    }, arguments);
  }, n.wbg.__wbg_instanceof_HtmlCanvasElement_2ea67072a7624ac5 = function() {
    return f(function(t) {
      let e;
      try {
        e = a(t) instanceof HTMLCanvasElement;
      } catch {
        e = !1;
      }
      const r = e;
      return L(r), r;
    }, arguments);
  }, n.wbg.__wbg_instanceof_HtmlDivElement_dbc6eb62eb772174 = function() {
    return f(function(t) {
      let e;
      try {
        e = a(t) instanceof HTMLDivElement;
      } catch {
        e = !1;
      }
      const r = e;
      return L(r), r;
    }, arguments);
  }, n.wbg.__wbg_instanceof_HtmlElement_51378c201250b16c = function() {
    return f(function(t) {
      let e;
      try {
        e = a(t) instanceof HTMLElement;
      } catch {
        e = !1;
      }
      const r = e;
      return L(r), r;
    }, arguments);
  }, n.wbg.__wbg_instanceof_HtmlTemplateElement_7929a67c77198607 = function() {
    return f(function(t) {
      let e;
      try {
        e = a(t) instanceof HTMLTemplateElement;
      } catch {
        e = !1;
      }
      const r = e;
      return L(r), r;
    }, arguments);
  }, n.wbg.__wbg_instanceof_ImageBitmap_d093d508663e313d = function() {
    return f(function(t) {
      let e;
      try {
        e = a(t) instanceof ImageBitmap;
      } catch {
        e = !1;
      }
      const r = e;
      return L(r), r;
    }, arguments);
  }, n.wbg.__wbg_instanceof_OffscreenCanvasRenderingContext2d_a070fdde7ba760a3 = function() {
    return f(function(t) {
      let e;
      try {
        e = a(t) instanceof OffscreenCanvasRenderingContext2D;
      } catch {
        e = !1;
      }
      const r = e;
      return L(r), r;
    }, arguments);
  }, n.wbg.__wbg_instanceof_OffscreenCanvas_d55760945f91bf51 = function() {
    return f(function(t) {
      let e;
      try {
        e = a(t) instanceof OffscreenCanvas;
      } catch {
        e = !1;
      }
      const r = e;
      return L(r), r;
    }, arguments);
  }, n.wbg.__wbg_instanceof_Promise_935168b8f4b49db3 = function() {
    return f(function(t) {
      let e;
      try {
        e = a(t) instanceof Promise;
      } catch {
        e = !1;
      }
      const r = e;
      return L(r), r;
    }, arguments);
  }, n.wbg.__wbg_instanceof_SvgGraphicsElement_8b2cbd8116680c53 = function() {
    return f(function(t) {
      let e;
      try {
        e = a(t) instanceof SVGGraphicsElement;
      } catch {
        e = !1;
      }
      const r = e;
      return L(r), r;
    }, arguments);
  }, n.wbg.__wbg_instanceof_SvgsvgElement_6a0d878e0d0f979c = function() {
    return f(function(t) {
      let e;
      try {
        e = a(t) instanceof SVGSVGElement;
      } catch {
        e = !1;
      }
      const r = e;
      return L(r), r;
    }, arguments);
  }, n.wbg.__wbg_instanceof_Window_def73ea0955fc569 = function() {
    return f(function(t) {
      let e;
      try {
        e = a(t) instanceof Window;
      } catch {
        e = !1;
      }
      const r = e;
      return L(r), r;
    }, arguments);
  }, n.wbg.__wbg_instanceof_WorkerGlobalScope_dbdbdea7e3b56493 = function() {
    return f(function(t) {
      let e;
      try {
        e = a(t) instanceof WorkerGlobalScope;
      } catch {
        e = !1;
      }
      const r = e;
      return L(r), r;
    }, arguments);
  }, n.wbg.__wbg_lastElementChild_1269b660ec3e6985 = function() {
    return f(function(t) {
      const e = a(t).lastElementChild;
      return A(e) ? 0 : m(e);
    }, arguments);
  }, n.wbg.__wbg_length_a446193dc22c12f8 = function() {
    return f(function(t) {
      const e = a(t).length;
      return l(e), e;
    }, arguments);
  }, n.wbg.__wbg_log_1ae1e9f741096e91 = function() {
    return f(function(t, e) {
      console.log(a(t), a(e));
    }, arguments);
  }, n.wbg.__wbg_log_c222819a41e063d3 = function() {
    return f(function(t) {
      console.log(a(t));
    }, arguments);
  }, n.wbg.__wbg_measureText_f0f078704231c37f = function() {
    return I(function(t, e, r) {
      const i = a(t).measureText(k(e, r));
      return m(i);
    }, arguments);
  }, n.wbg.__wbg_new_23a2665fac83c611 = function() {
    return f(function(t, e) {
      try {
        var r = { a: t, b: e }, i = (s, c) => {
          const d = r.a;
          r.a = 0;
          try {
            return xn(d, r.b, s, c);
          } finally {
            r.a = d;
          }
        };
        const o = new Promise(i);
        return m(o);
      } finally {
        r.a = r.b = 0;
      }
    }, arguments);
  }, n.wbg.__wbg_new_2ef971087cb43792 = function() {
    return I(function(t, e) {
      const r = new OffscreenCanvas(t >>> 0, e >>> 0);
      return m(r);
    }, arguments);
  }, n.wbg.__wbg_new_405e22f390576ce2 = function() {
    return f(function() {
      const t = new Object();
      return m(t);
    }, arguments);
  }, n.wbg.__wbg_new_6377da097a44ce6e = function() {
    return I(function() {
      const t = new Image();
      return m(t);
    }, arguments);
  }, n.wbg.__wbg_new_78feb108b6472713 = function() {
    return f(function() {
      const t = new Array();
      return m(t);
    }, arguments);
  }, n.wbg.__wbg_new_8a6f238a6ece86ea = function() {
    return f(function() {
      const t = new Error();
      return m(t);
    }, arguments);
  }, n.wbg.__wbg_new_a12002a7f91c75be = function() {
    return f(function(t) {
      const e = new Uint8Array(a(t));
      return m(e);
    }, arguments);
  }, n.wbg.__wbg_new_c68d7209be747379 = function() {
    return f(function(t, e) {
      const r = new Error(k(t, e));
      return m(r);
    }, arguments);
  }, n.wbg.__wbg_newnoargs_105ed471475aaf50 = function() {
    return f(function(t, e) {
      const r = new Function(k(t, e));
      return m(r);
    }, arguments);
  }, n.wbg.__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a = function() {
    return f(function(t, e, r) {
      const i = new Uint8Array(a(t), e >>> 0, r >>> 0);
      return m(i);
    }, arguments);
  }, n.wbg.__wbg_newwithlength_a381634e90c276d4 = function() {
    return f(function(t) {
      const e = new Uint8Array(t >>> 0);
      return m(e);
    }, arguments);
  }, n.wbg.__wbg_newwithpathstring_e9586ab3affcd4fd = function() {
    return I(function(t, e) {
      const r = new Path2D(k(t, e));
      return m(r);
    }, arguments);
  }, n.wbg.__wbg_newwithu8arraysequenceandoptions_068570c487f69127 = function() {
    return I(function(t, e) {
      const r = new Blob(a(t), a(e));
      return m(r);
    }, arguments);
  }, n.wbg.__wbg_nextElementSibling_8472709bec4de113 = function() {
    return f(function(t) {
      const e = a(t).nextElementSibling;
      return A(e) ? 0 : m(e);
    }, arguments);
  }, n.wbg.__wbg_push_737cfc8c1432c2c6 = function() {
    return f(function(t, e) {
      const r = a(t).push(a(e));
      return l(r), r;
    }, arguments);
  }, n.wbg.__wbg_putImageData_4c5aa10f3b3e4924 = function() {
    return I(function(t, e, r, i) {
      a(t).putImageData(a(e), r, i);
    }, arguments);
  }, n.wbg.__wbg_putImageData_6d5d5ef6ee83898b = function() {
    return I(function(t, e, r, i) {
      a(t).putImageData(a(e), r, i);
    }, arguments);
  }, n.wbg.__wbg_queueMicrotask_97d92b4fcc8a61c5 = function() {
    return f(function(t) {
      queueMicrotask(a(t));
    }, arguments);
  }, n.wbg.__wbg_queueMicrotask_d3219def82552485 = function() {
    return f(function(t) {
      const e = a(t).queueMicrotask;
      return m(e);
    }, arguments);
  }, n.wbg.__wbg_removeProperty_0e85471f4dfc00ae = function() {
    return I(function(t, e, r, i) {
      const o = a(e).removeProperty(k(r, i)), s = F(o, _.__wbindgen_export_1, _.__wbindgen_export_2), c = P;
      h().setInt32(t + 4 * 1, c, !0), h().setInt32(t + 4 * 0, s, !0);
    }, arguments);
  }, n.wbg.__wbg_remove_e2d2659f3128c045 = function() {
    return f(function(t) {
      a(t).remove();
    }, arguments);
  }, n.wbg.__wbg_renderpageimageoptions_unwrap = function() {
    return f(function(t) {
      const e = ot.__unwrap(R(t));
      return l(e), e;
    }, arguments);
  }, n.wbg.__wbg_replaceWith_9ce9927e3141d0f6 = function() {
    return I(function(t, e) {
      a(t).replaceWith(a(e));
    }, arguments);
  }, n.wbg.__wbg_resolve_4851785c9c5f573d = function() {
    return f(function(t) {
      const e = Promise.resolve(a(t));
      return m(e);
    }, arguments);
  }, n.wbg.__wbg_restore_1ef50af0835a4649 = function() {
    return f(function(t) {
      a(t).restore();
    }, arguments);
  }, n.wbg.__wbg_restore_cc5ae2746f7b5043 = function() {
    return f(function(t) {
      a(t).restore();
    }, arguments);
  }, n.wbg.__wbg_revokeObjectURL_27267efebeb457c7 = function() {
    return I(function(t, e) {
      URL.revokeObjectURL(k(t, e));
    }, arguments);
  }, n.wbg.__wbg_save_5f563096e64939da = function() {
    return f(function(t) {
      a(t).save();
    }, arguments);
  }, n.wbg.__wbg_save_c675a7a4bbd44e4a = function() {
    return f(function(t) {
      a(t).save();
    }, arguments);
  }, n.wbg.__wbg_setAttribute_2704501201f15687 = function() {
    return I(function(t, e, r, i, o) {
      a(t).setAttribute(k(e, r), k(i, o));
    }, arguments);
  }, n.wbg.__wbg_setLineDash_0e3f3e194352a774 = function() {
    return I(function(t, e) {
      a(t).setLineDash(a(e));
    }, arguments);
  }, n.wbg.__wbg_setLineDash_325e094206df53e9 = function() {
    return I(function(t, e) {
      a(t).setLineDash(a(e));
    }, arguments);
  }, n.wbg.__wbg_setProperty_f2cf326652b9a713 = function() {
    return I(function(t, e, r, i, o) {
      a(t).setProperty(k(e, r), k(i, o));
    }, arguments);
  }, n.wbg.__wbg_setTransform_8c4d954cafb34b75 = function() {
    return I(function(t, e, r, i, o, s, c) {
      a(t).setTransform(e, r, i, o, s, c);
    }, arguments);
  }, n.wbg.__wbg_setTransform_da2f0baec3f09522 = function() {
    return I(function(t, e, r, i, o, s, c) {
      a(t).setTransform(e, r, i, o, s, c);
    }, arguments);
  }, n.wbg.__wbg_set_37837023f3d740e8 = function() {
    return f(function(t, e, r) {
      a(t)[e >>> 0] = R(r);
    }, arguments);
  }, n.wbg.__wbg_set_65595bdd868b3009 = function() {
    return f(function(t, e, r) {
      a(t).set(a(e), r >>> 0);
    }, arguments);
  }, n.wbg.__wbg_set_bb8cecf6a62b9f46 = function() {
    return I(function(t, e, r) {
      const i = Reflect.set(a(t), a(e), a(r));
      return L(i), i;
    }, arguments);
  }, n.wbg.__wbg_setfillStyle_2205fca942c641ba = function() {
    return f(function(t, e, r) {
      a(t).fillStyle = k(e, r);
    }, arguments);
  }, n.wbg.__wbg_setfillStyle_cb059a69ce15cc28 = function() {
    return f(function(t, e, r) {
      a(t).fillStyle = k(e, r);
    }, arguments);
  }, n.wbg.__wbg_setfont_4c3584ef2f5c9f7e = function() {
    return f(function(t, e, r) {
      a(t).font = k(e, r);
    }, arguments);
  }, n.wbg.__wbg_setglobalCompositeOperation_9a7a92bac2fb7ffd = function() {
    return I(function(t, e, r) {
      a(t).globalCompositeOperation = k(e, r);
    }, arguments);
  }, n.wbg.__wbg_setglobalCompositeOperation_b000e874f8f4a9d3 = function() {
    return I(function(t, e, r) {
      a(t).globalCompositeOperation = k(e, r);
    }, arguments);
  }, n.wbg.__wbg_setheight_da683a33fa99843c = function() {
    return f(function(t, e) {
      a(t).height = e >>> 0;
    }, arguments);
  }, n.wbg.__wbg_setinnerHTML_31bde41f835786f7 = function() {
    return f(function(t, e, r) {
      a(t).innerHTML = k(e, r);
    }, arguments);
  }, n.wbg.__wbg_setlineCap_3a3987ad3f03b31d = function() {
    return f(function(t, e, r) {
      a(t).lineCap = k(e, r);
    }, arguments);
  }, n.wbg.__wbg_setlineCap_52b6d742c95a5630 = function() {
    return f(function(t, e, r) {
      a(t).lineCap = k(e, r);
    }, arguments);
  }, n.wbg.__wbg_setlineDashOffset_030d80d07cd52ee4 = function() {
    return f(function(t, e) {
      a(t).lineDashOffset = e;
    }, arguments);
  }, n.wbg.__wbg_setlineDashOffset_59f274962f6a0553 = function() {
    return f(function(t, e) {
      a(t).lineDashOffset = e;
    }, arguments);
  }, n.wbg.__wbg_setlineJoin_79ca64e7e9efaff7 = function() {
    return f(function(t, e, r) {
      a(t).lineJoin = k(e, r);
    }, arguments);
  }, n.wbg.__wbg_setlineJoin_7e005d90ef83d627 = function() {
    return f(function(t, e, r) {
      a(t).lineJoin = k(e, r);
    }, arguments);
  }, n.wbg.__wbg_setlineWidth_3c8b7156949a9f4b = function() {
    return f(function(t, e) {
      a(t).lineWidth = e;
    }, arguments);
  }, n.wbg.__wbg_setlineWidth_ec730c524f09baa9 = function() {
    return f(function(t, e) {
      a(t).lineWidth = e;
    }, arguments);
  }, n.wbg.__wbg_setmiterLimit_26162c359bb28eb2 = function() {
    return f(function(t, e) {
      a(t).miterLimit = e;
    }, arguments);
  }, n.wbg.__wbg_setmiterLimit_9ffca64ec692501d = function() {
    return f(function(t, e) {
      a(t).miterLimit = e;
    }, arguments);
  }, n.wbg.__wbg_setonerror_e94ca1221abc457f = function() {
    return f(function(t, e) {
      a(t).onerror = a(e);
    }, arguments);
  }, n.wbg.__wbg_setonload_264a0d330b7166fb = function() {
    return f(function(t, e) {
      a(t).onload = a(e);
    }, arguments);
  }, n.wbg.__wbg_setsrc_c239193cc7ab0470 = function() {
    return f(function(t, e, r) {
      a(t).src = k(e, r);
    }, arguments);
  }, n.wbg.__wbg_setstrokeStyle_070920f27992b9a6 = function() {
    return f(function(t, e, r) {
      a(t).strokeStyle = k(e, r);
    }, arguments);
  }, n.wbg.__wbg_setstrokeStyle_415833f3f0eb5076 = function() {
    return f(function(t, e, r) {
      a(t).strokeStyle = k(e, r);
    }, arguments);
  }, n.wbg.__wbg_settype_39ed370d3edd403c = function() {
    return f(function(t, e, r) {
      a(t).type = k(e, r);
    }, arguments);
  }, n.wbg.__wbg_setwidth_c5fed9f5e7f0b406 = function() {
    return f(function(t, e) {
      a(t).width = e >>> 0;
    }, arguments);
  }, n.wbg.__wbg_stack_0ed75d68575b0f3c = function() {
    return f(function(t, e) {
      const r = a(e).stack, i = F(r, _.__wbindgen_export_1, _.__wbindgen_export_2), o = P;
      h().setInt32(t + 4 * 1, o, !0), h().setInt32(t + 4 * 0, i, !0);
    }, arguments);
  }, n.wbg.__wbg_static_accessor_GLOBAL_88a902d13a557d07 = function() {
    return f(function() {
      const t = typeof global > "u" ? null : global;
      return A(t) ? 0 : m(t);
    }, arguments);
  }, n.wbg.__wbg_static_accessor_GLOBAL_THIS_56578be7e9f832b0 = function() {
    return f(function() {
      const t = typeof globalThis > "u" ? null : globalThis;
      return A(t) ? 0 : m(t);
    }, arguments);
  }, n.wbg.__wbg_static_accessor_SELF_37c5d418e4bf5819 = function() {
    return f(function() {
      const t = typeof self > "u" ? null : self;
      return A(t) ? 0 : m(t);
    }, arguments);
  }, n.wbg.__wbg_static_accessor_WINDOW_5de37043a91a9c40 = function() {
    return f(function() {
      const t = typeof window > "u" ? null : window;
      return A(t) ? 0 : m(t);
    }, arguments);
  }, n.wbg.__wbg_stringify_f7ed6987935b4a24 = function() {
    return I(function(t) {
      const e = JSON.stringify(a(t));
      return m(e);
    }, arguments);
  }, n.wbg.__wbg_stroke_1b0348380fb5a54b = function() {
    return f(function(t, e) {
      a(t).stroke(a(e));
    }, arguments);
  }, n.wbg.__wbg_stroke_e9b15e77122a9be9 = function() {
    return f(function(t, e) {
      a(t).stroke(a(e));
    }, arguments);
  }, n.wbg.__wbg_style_fb30c14e5815805c = function() {
    return f(function(t) {
      const e = a(t).style;
      return m(e);
    }, arguments);
  }, n.wbg.__wbg_then_44b73946d2fb3e7d = function() {
    return f(function(t, e) {
      const r = a(t).then(a(e));
      return m(r);
    }, arguments);
  }, n.wbg.__wbg_then_48b406749878a531 = function() {
    return f(function(t, e, r) {
      const i = a(t).then(a(e), a(r));
      return m(i);
    }, arguments);
  }, n.wbg.__wbg_transferToImageBitmap_4b1cc41c0f7e5de5 = function() {
    return I(function(t) {
      const e = a(t).transferToImageBitmap();
      return m(e);
    }, arguments);
  }, n.wbg.__wbg_typstrenderer_new = function() {
    return f(function(t) {
      const e = lt.__wrap(t);
      return m(e);
    }, arguments);
  }, n.wbg.__wbg_warn_4ca3906c248c47c4 = function() {
    return f(function(t) {
      console.warn(a(t));
    }, arguments);
  }, n.wbg.__wbg_width_2fafd30484634e26 = function() {
    return f(function(t) {
      return a(t).width;
    }, arguments);
  }, n.wbg.__wbg_width_4f334fc47ef03de1 = function() {
    return f(function(t) {
      const e = a(t).width;
      return l(e), e;
    }, arguments);
  }, n.wbg.__wbindgen_cb_drop = function(t) {
    const e = R(t).original;
    if (e.cnt-- == 1)
      return e.a = 0, !0;
    const r = !1;
    return L(r), r;
  }, n.wbg.__wbindgen_closure_wrapper1054 = function() {
    return f(function(t, e, r) {
      const i = ln(t, e, 480, vn);
      return m(i);
    }, arguments);
  }, n.wbg.__wbindgen_closure_wrapper986 = function() {
    return f(function(t, e, r) {
      const i = zt(t, e, 448, mn);
      return m(i);
    }, arguments);
  }, n.wbg.__wbindgen_closure_wrapper987 = function() {
    return f(function(t, e, r) {
      const i = zt(t, e, 448, yn);
      return m(i);
    }, arguments);
  }, n.wbg.__wbindgen_debug_string = function(t, e) {
    const r = Ct(a(e)), i = F(r, _.__wbindgen_export_1, _.__wbindgen_export_2), o = P;
    h().setInt32(t + 4 * 1, o, !0), h().setInt32(t + 4 * 0, i, !0);
  }, n.wbg.__wbindgen_is_function = function(t) {
    const e = typeof a(t) == "function";
    return L(e), e;
  }, n.wbg.__wbindgen_is_undefined = function(t) {
    const e = a(t) === void 0;
    return L(e), e;
  }, n.wbg.__wbindgen_jsval_eq = function(t, e) {
    const r = a(t) === a(e);
    return L(r), r;
  }, n.wbg.__wbindgen_memory = function() {
    const t = _.memory;
    return m(t);
  }, n.wbg.__wbindgen_number_new = function(t) {
    return m(t);
  }, n.wbg.__wbindgen_object_clone_ref = function(t) {
    const e = a(t);
    return m(e);
  }, n.wbg.__wbindgen_object_drop_ref = function(t) {
    R(t);
  }, n.wbg.__wbindgen_string_get = function(t, e) {
    const r = a(e), i = typeof r == "string" ? r : void 0;
    var o = A(i) ? 0 : F(i, _.__wbindgen_export_1, _.__wbindgen_export_2), s = P;
    h().setInt32(t + 4 * 1, s, !0), h().setInt32(t + 4 * 0, o, !0);
  }, n.wbg.__wbindgen_string_new = function(t, e) {
    const r = k(t, e);
    return m(r);
  }, n.wbg.__wbindgen_throw = function(t, e) {
    throw new Error(k(t, e));
  }, n;
}
function be(n, t) {
  return _ = n.exports, pe.__wbindgen_wasm_module = t, V = null, Y = null, Q = null, _;
}
function An(n) {
  if (_ !== void 0) return _;
  typeof n < "u" && (Object.getPrototypeOf(n) === Object.prototype ? { module: n } = n : console.warn("using deprecated parameters for `initSync()`; pass a single object instead"));
  const t = le();
  n instanceof WebAssembly.Module || (n = new WebAssembly.Module(n));
  const e = new WebAssembly.Instance(n, t);
  return be(e, n);
}
async function pe(n) {
  if (_ !== void 0) return _;
  typeof n < "u" && (Object.getPrototypeOf(n) === Object.prototype ? { module_or_path: n } = n : console.warn("using deprecated parameters for the initialization function; pass a single object instead")), typeof n > "u" && (n = he("typst_ts_renderer_bg.wasm", import.meta.url));
  const t = le();
  (typeof n == "string" || typeof Request == "function" && n instanceof Request || typeof URL == "function" && n instanceof URL) && (n = fetch(n));
  const { instance: e, module: r } = await Rn(await n, t);
  return be(e, r);
}
let he = async function(n, t) {
  throw new Error("Cannot import wasm module without importer: " + n + " " + t);
};
function me(n) {
  he = n;
}
let Cn = async function(n, t) {
  const e = new Function("m", "return import(m)"), { readFileSync: r } = await e("fs"), i = new URL(n, t);
  return await r(i).buffer;
};
const Mn = typeof process < "u" && process.versions != null && process.versions.node != null;
Mn && me(Cn);
const ye = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  CreateSessionOptions: we,
  IncrDomDocClient: ft,
  PageInfo: rt,
  PagesInfo: wt,
  RenderPageImageOptions: ot,
  RenderSession: W,
  RenderSessionOptions: In,
  TypstRenderer: lt,
  TypstRendererBuilder: kn,
  TypstWorker: Sn,
  WorkerBridge: bt,
  default: pe,
  initSync: An,
  renderer_build_info: hn,
  setImportWasmModule: me
}, Symbol.toStringTag, { value: "Module" }));
let u;
const H = new Array(128).fill(void 0);
H.push(void 0, null, !0, !1);
function b(n) {
  return H[n];
}
let nt = H.length;
function y(n) {
  nt === H.length && H.push(H.length + 1);
  const t = nt;
  return nt = H[t], H[t] = n, t;
}
function G(n, t) {
  try {
    return n.apply(this, t);
  } catch (e) {
    u.__wbindgen_export_0(y(e));
  }
}
const ve = typeof TextDecoder < "u" ? new TextDecoder("utf-8", { ignoreBOM: !0, fatal: !0 }) : { decode: () => {
  throw Error("TextDecoder not available");
} };
typeof TextDecoder < "u" && ve.decode();
let Z = null;
function X() {
  return (Z === null || Z.byteLength === 0) && (Z = new Uint8Array(u.memory.buffer)), Z;
}
function q(n, t) {
  return n = n >>> 0, ve.decode(X().subarray(n, n + t));
}
function Pn(n) {
  n < 132 || (H[n] = nt, nt = n);
}
function S(n) {
  const t = b(n);
  return Pn(n), t;
}
let M = 0;
const at = typeof TextEncoder < "u" ? new TextEncoder("utf-8") : { encode: () => {
  throw Error("TextEncoder not available");
} }, Tn = typeof at.encodeInto == "function" ? function(n, t) {
  return at.encodeInto(n, t);
} : function(n, t) {
  const e = at.encode(n);
  return t.set(e), {
    read: n.length,
    written: e.length
  };
};
function O(n, t, e) {
  if (e === void 0) {
    const c = at.encode(n), d = t(c.length, 1) >>> 0;
    return X().subarray(d, d + c.length).set(c), M = c.length, d;
  }
  let r = n.length, i = t(r, 1) >>> 0;
  const o = X();
  let s = 0;
  for (; s < r; s++) {
    const c = n.charCodeAt(s);
    if (c > 127) break;
    o[i + s] = c;
  }
  if (s !== r) {
    s !== 0 && (n = n.slice(s)), i = e(i, r, r = s + n.length * 3, 1) >>> 0;
    const c = X().subarray(i + s, i + r), d = Tn(n, c);
    s += d.written, i = e(i, r, s, 1) >>> 0;
  }
  return M = s, i;
}
let J = null;
function x() {
  return (J === null || J.buffer.detached === !0 || J.buffer.detached === void 0 && J.buffer !== u.memory.buffer) && (J = new DataView(u.memory.buffer)), J;
}
function $(n) {
  return n == null;
}
const Zt = typeof FinalizationRegistry > "u" ? { register: () => {
}, unregister: () => {
} } : new FinalizationRegistry((n) => {
  u.__wbindgen_export_4.get(n.dtor)(n.a, n.b);
});
function Ln(n, t, e, r) {
  const i = { a: n, b: t, cnt: 1, dtor: e }, o = (...s) => {
    i.cnt++;
    const c = i.a;
    i.a = 0;
    try {
      return r(c, i.b, ...s);
    } finally {
      --i.cnt === 0 ? (u.__wbindgen_export_4.get(i.dtor)(c, i.b), Zt.unregister(i)) : i.a = c;
    }
  };
  return o.original = i, Zt.register(o, i, i), o;
}
function Mt(n) {
  const t = typeof n;
  if (t == "number" || t == "boolean" || n == null)
    return `${n}`;
  if (t == "string")
    return `"${n}"`;
  if (t == "symbol") {
    const i = n.description;
    return i == null ? "Symbol" : `Symbol(${i})`;
  }
  if (t == "function") {
    const i = n.name;
    return typeof i == "string" && i.length > 0 ? `Function(${i})` : "Function";
  }
  if (Array.isArray(n)) {
    const i = n.length;
    let o = "[";
    i > 0 && (o += Mt(n[0]));
    for (let s = 1; s < i; s++)
      o += ", " + Mt(n[s]);
    return o += "]", o;
  }
  const e = /\[object ([^\]]+)\]/.exec(toString.call(n));
  let r;
  if (e && e.length > 1)
    r = e[1];
  else
    return toString.call(n);
  if (r == "Object")
    try {
      return "Object(" + JSON.stringify(n) + ")";
    } catch {
      return "Object";
    }
  return n instanceof Error ? `${n.name}: ${n.message}
${n.stack}` : r;
}
function On(n) {
  const t = u.get_font_info(y(n));
  return S(t);
}
function xe(n, t) {
  const e = t(n.length * 1, 1) >>> 0;
  return X().set(n, e / 1), M = n.length, e;
}
function Fn(n, t) {
  n = n >>> 0;
  const e = x(), r = [];
  for (let i = n; i < n + 4 * t; i += 4)
    r.push(S(e.getUint32(i, !0)));
  return r;
}
function st(n, t) {
  const e = t(n.length * 4, 4) >>> 0, r = x();
  for (let i = 0; i < n.length; i++)
    r.setUint32(e + 4 * i, y(n[i]), !0);
  return M = n.length, e;
}
function Dn(n, t) {
  if (!(n instanceof t))
    throw new Error(`expected instance of ${t.name}`);
}
function $n(n, t) {
  return n = n >>> 0, X().subarray(n / 1, n / 1 + t);
}
function jn(n, t, e) {
  u.__wbindgen_export_5(n, t, y(e));
}
function Wn(n, t, e, r) {
  u.__wbindgen_export_6(n, t, y(e), y(r));
}
const te = typeof FinalizationRegistry > "u" ? { register: () => {
}, unregister: () => {
} } : new FinalizationRegistry((n) => u.__wbg_incrserver_free(n >>> 0, 1));
class it {
  static __wrap(t) {
    t = t >>> 0;
    const e = Object.create(it.prototype);
    return e.__wbg_ptr = t, te.register(e, e.__wbg_ptr, e), e;
  }
  __destroy_into_raw() {
    const t = this.__wbg_ptr;
    return this.__wbg_ptr = 0, te.unregister(this), t;
  }
  free() {
    const t = this.__destroy_into_raw();
    u.__wbg_incrserver_free(t, 0);
  }
  /**
   * @param {boolean} attach
   */
  set_attach_debug_info(t) {
    u.incrserver_set_attach_debug_info(this.__wbg_ptr, t);
  }
  /**
   * @returns {Uint8Array | undefined}
   */
  current() {
    try {
      const r = u.__wbindgen_add_to_stack_pointer(-16);
      u.incrserver_current(r, this.__wbg_ptr);
      var t = x().getInt32(r + 4 * 0, !0), e = x().getInt32(r + 4 * 1, !0);
      let i;
      return t !== 0 && (i = $n(t, e).slice(), u.__wbindgen_export_1(t, e * 1, 1)), i;
    } finally {
      u.__wbindgen_add_to_stack_pointer(16);
    }
  }
  reset() {
    u.incrserver_reset(this.__wbg_ptr);
  }
}
const Et = typeof FinalizationRegistry > "u" ? { register: () => {
}, unregister: () => {
} } : new FinalizationRegistry((n) => u.__wbg_proxycontext_free(n >>> 0, 1));
class pt {
  static __wrap(t) {
    t = t >>> 0;
    const e = Object.create(pt.prototype);
    return e.__wbg_ptr = t, Et.register(e, e.__wbg_ptr, e), e;
  }
  __destroy_into_raw() {
    const t = this.__wbg_ptr;
    return this.__wbg_ptr = 0, Et.unregister(this), t;
  }
  free() {
    const t = this.__destroy_into_raw();
    u.__wbg_proxycontext_free(t, 0);
  }
  /**
   * Creates a new `ProxyContext` instance.
   * @param {any} context
   */
  constructor(t) {
    const e = u.proxycontext_new(y(t));
    return this.__wbg_ptr = e >>> 0, Et.register(this, this.__wbg_ptr, this), this;
  }
  /**
   * Returns the JavaScript this.
   * @returns {any}
   */
  get context() {
    const t = u.proxycontext_context(this.__wbg_ptr);
    return S(t);
  }
  /**
   * A convenience function to untar a tarball and call a callback for each
   * entry.
   * @param {Uint8Array} data
   * @param {Function} cb
   */
  untar(t, e) {
    try {
      const o = u.__wbindgen_add_to_stack_pointer(-16), s = xe(t, u.__wbindgen_export_2), c = M;
      u.proxycontext_untar(o, this.__wbg_ptr, s, c, y(e));
      var r = x().getInt32(o + 4 * 0, !0), i = x().getInt32(o + 4 * 1, !0);
      if (i)
        throw S(r);
    } finally {
      u.__wbindgen_add_to_stack_pointer(16);
    }
  }
}
const ee = typeof FinalizationRegistry > "u" ? { register: () => {
}, unregister: () => {
} } : new FinalizationRegistry((n) => u.__wbg_typstcompiler_free(n >>> 0, 1));
class ht {
  static __wrap(t) {
    t = t >>> 0;
    const e = Object.create(ht.prototype);
    return e.__wbg_ptr = t, ee.register(e, e.__wbg_ptr, e), e;
  }
  __destroy_into_raw() {
    const t = this.__wbg_ptr;
    return this.__wbg_ptr = 0, ee.unregister(this), t;
  }
  free() {
    const t = this.__destroy_into_raw();
    u.__wbg_typstcompiler_free(t, 0);
  }
  reset() {
    try {
      const r = u.__wbindgen_add_to_stack_pointer(-16);
      u.typstcompiler_reset(r, this.__wbg_ptr);
      var t = x().getInt32(r + 4 * 0, !0), e = x().getInt32(r + 4 * 1, !0);
      if (e)
        throw S(t);
    } finally {
      u.__wbindgen_add_to_stack_pointer(16);
    }
  }
  /**
   * @param {any} inputs
   */
  set_inputs(t) {
    try {
      const i = u.__wbindgen_add_to_stack_pointer(-16);
      u.typstcompiler_set_inputs(i, this.__wbg_ptr, y(t));
      var e = x().getInt32(i + 4 * 0, !0), r = x().getInt32(i + 4 * 1, !0);
      if (r)
        throw S(e);
    } finally {
      u.__wbindgen_add_to_stack_pointer(16);
    }
  }
  /**
   * @param {string} path
   * @param {string} content
   * @returns {boolean}
   */
  add_source(t, e) {
    const r = O(t, u.__wbindgen_export_2, u.__wbindgen_export_3), i = M, o = O(e, u.__wbindgen_export_2, u.__wbindgen_export_3), s = M;
    return u.typstcompiler_add_source(this.__wbg_ptr, r, i, o, s) !== 0;
  }
  /**
   * @param {string} path
   * @param {Uint8Array} content
   * @returns {boolean}
   */
  map_shadow(t, e) {
    const r = O(t, u.__wbindgen_export_2, u.__wbindgen_export_3), i = M, o = xe(e, u.__wbindgen_export_2), s = M;
    return u.typstcompiler_map_shadow(this.__wbg_ptr, r, i, o, s) !== 0;
  }
  /**
   * @param {string} path
   * @returns {boolean}
   */
  unmap_shadow(t) {
    const e = O(t, u.__wbindgen_export_2, u.__wbindgen_export_3), r = M;
    return u.typstcompiler_unmap_shadow(this.__wbg_ptr, e, r) !== 0;
  }
  reset_shadow() {
    u.typstcompiler_reset_shadow(this.__wbg_ptr);
  }
  /**
   * @returns {string[]}
   */
  get_loaded_fonts() {
    try {
      const i = u.__wbindgen_add_to_stack_pointer(-16);
      u.typstcompiler_get_loaded_fonts(i, this.__wbg_ptr);
      var t = x().getInt32(i + 4 * 0, !0), e = x().getInt32(i + 4 * 1, !0), r = Fn(t, e).slice();
      return u.__wbindgen_export_1(t, e * 4, 4), r;
    } finally {
      u.__wbindgen_add_to_stack_pointer(16);
    }
  }
  /**
   * @param {string} main_file_path
   * @returns {string}
   */
  get_ast(t) {
    let e, r;
    try {
      const w = u.__wbindgen_add_to_stack_pointer(-16), v = O(t, u.__wbindgen_export_2, u.__wbindgen_export_3), T = M;
      u.typstcompiler_get_ast(w, this.__wbg_ptr, v, T);
      var i = x().getInt32(w + 4 * 0, !0), o = x().getInt32(w + 4 * 1, !0), s = x().getInt32(w + 4 * 2, !0), c = x().getInt32(w + 4 * 3, !0), d = i, g = o;
      if (c)
        throw d = 0, g = 0, S(s);
      return e = d, r = g, q(d, g);
    } finally {
      u.__wbindgen_add_to_stack_pointer(16), u.__wbindgen_export_1(e, r, 1);
    }
  }
  /**
   * @returns {any}
   */
  get_semantic_token_legend() {
    try {
      const i = u.__wbindgen_add_to_stack_pointer(-16);
      u.typstcompiler_get_semantic_token_legend(i, this.__wbg_ptr);
      var t = x().getInt32(i + 4 * 0, !0), e = x().getInt32(i + 4 * 1, !0), r = x().getInt32(i + 4 * 2, !0);
      if (r)
        throw S(e);
      return S(t);
    } finally {
      u.__wbindgen_add_to_stack_pointer(16);
    }
  }
  /**
   * @param {string} offset_encoding
   * @param {string | null} [file_path]
   * @param {string | null} [result_id]
   * @returns {object}
   */
  get_semantic_tokens(t, e, r) {
    try {
      const v = u.__wbindgen_add_to_stack_pointer(-16), T = O(t, u.__wbindgen_export_2, u.__wbindgen_export_3), C = M;
      var i = $(e) ? 0 : O(e, u.__wbindgen_export_2, u.__wbindgen_export_3), o = M, s = $(r) ? 0 : O(r, u.__wbindgen_export_2, u.__wbindgen_export_3), c = M;
      u.typstcompiler_get_semantic_tokens(v, this.__wbg_ptr, T, C, i, o, s, c);
      var d = x().getInt32(v + 4 * 0, !0), g = x().getInt32(v + 4 * 1, !0), w = x().getInt32(v + 4 * 2, !0);
      if (w)
        throw S(g);
      return S(d);
    } finally {
      u.__wbindgen_add_to_stack_pointer(16);
    }
  }
  /**
   * @param {string} fmt
   * @param {number} diagnostics_format
   * @returns {any}
   */
  get_artifact(t, e) {
    try {
      const s = u.__wbindgen_add_to_stack_pointer(-16), c = O(t, u.__wbindgen_export_2, u.__wbindgen_export_3), d = M;
      u.typstcompiler_get_artifact(s, this.__wbg_ptr, c, d, e);
      var r = x().getInt32(s + 4 * 0, !0), i = x().getInt32(s + 4 * 1, !0), o = x().getInt32(s + 4 * 2, !0);
      if (o)
        throw S(i);
      return S(r);
    } finally {
      u.__wbindgen_add_to_stack_pointer(16);
    }
  }
  /**
   * @param {string} main_file_path
   * @param {(Array<any>)[] | null} [inputs]
   */
  set_compiler_options(t, e) {
    try {
      const c = u.__wbindgen_add_to_stack_pointer(-16), d = O(t, u.__wbindgen_export_2, u.__wbindgen_export_3), g = M;
      var r = $(e) ? 0 : st(e, u.__wbindgen_export_2), i = M;
      u.typstcompiler_set_compiler_options(c, this.__wbg_ptr, d, g, r, i);
      var o = x().getInt32(c + 4 * 0, !0), s = x().getInt32(c + 4 * 1, !0);
      if (s)
        throw S(o);
    } finally {
      u.__wbindgen_add_to_stack_pointer(16);
    }
  }
  /**
   * @param {string} main_file_path
   * @param {(Array<any>)[] | null | undefined} inputs
   * @param {string} selector
   * @param {string | null} [field]
   * @returns {string}
   */
  query(t, e, r, i) {
    let o, s;
    try {
      const j = u.__wbindgen_add_to_stack_pointer(-16), Ce = O(t, u.__wbindgen_export_2, u.__wbindgen_export_3), Me = M;
      var c = $(e) ? 0 : st(e, u.__wbindgen_export_2), d = M;
      const Pe = O(r, u.__wbindgen_export_2, u.__wbindgen_export_3), Te = M;
      var g = $(i) ? 0 : O(i, u.__wbindgen_export_2, u.__wbindgen_export_3), w = M;
      u.typstcompiler_query(j, this.__wbg_ptr, Ce, Me, c, d, Pe, Te, g, w);
      var v = x().getInt32(j + 4 * 0, !0), T = x().getInt32(j + 4 * 1, !0), C = x().getInt32(j + 4 * 2, !0), B = x().getInt32(j + 4 * 3, !0), D = v, z = T;
      if (B)
        throw D = 0, z = 0, S(C);
      return o = D, s = z, q(D, z);
    } finally {
      u.__wbindgen_add_to_stack_pointer(16), u.__wbindgen_export_1(o, s, 1);
    }
  }
  /**
   * @param {string} main_file_path
   * @param {(Array<any>)[] | null | undefined} inputs
   * @param {string} fmt
   * @param {number} diagnostics_format
   * @returns {any}
   */
  compile(t, e, r, i) {
    try {
      const w = u.__wbindgen_add_to_stack_pointer(-16), v = O(t, u.__wbindgen_export_2, u.__wbindgen_export_3), T = M;
      var o = $(e) ? 0 : st(e, u.__wbindgen_export_2), s = M;
      const C = O(r, u.__wbindgen_export_2, u.__wbindgen_export_3), B = M;
      u.typstcompiler_compile(w, this.__wbg_ptr, v, T, o, s, C, B, i);
      var c = x().getInt32(w + 4 * 0, !0), d = x().getInt32(w + 4 * 1, !0), g = x().getInt32(w + 4 * 2, !0);
      if (g)
        throw S(d);
      return S(c);
    } finally {
      u.__wbindgen_add_to_stack_pointer(16);
    }
  }
  /**
   * @returns {IncrServer}
   */
  create_incr_server() {
    try {
      const i = u.__wbindgen_add_to_stack_pointer(-16);
      u.typstcompiler_create_incr_server(i, this.__wbg_ptr);
      var t = x().getInt32(i + 4 * 0, !0), e = x().getInt32(i + 4 * 1, !0), r = x().getInt32(i + 4 * 2, !0);
      if (r)
        throw S(e);
      return it.__wrap(t);
    } finally {
      u.__wbindgen_add_to_stack_pointer(16);
    }
  }
  /**
   * @param {string} main_file_path
   * @param {(Array<any>)[] | null | undefined} inputs
   * @param {IncrServer} state
   * @param {number} diagnostics_format
   * @returns {any}
   */
  incr_compile(t, e, r, i) {
    try {
      const w = u.__wbindgen_add_to_stack_pointer(-16), v = O(t, u.__wbindgen_export_2, u.__wbindgen_export_3), T = M;
      var o = $(e) ? 0 : st(e, u.__wbindgen_export_2), s = M;
      Dn(r, it), u.typstcompiler_incr_compile(w, this.__wbg_ptr, v, T, o, s, r.__wbg_ptr, i);
      var c = x().getInt32(w + 4 * 0, !0), d = x().getInt32(w + 4 * 1, !0), g = x().getInt32(w + 4 * 2, !0);
      if (g)
        throw S(d);
      return S(c);
    } finally {
      u.__wbindgen_add_to_stack_pointer(16);
    }
  }
}
const ne = typeof FinalizationRegistry > "u" ? { register: () => {
}, unregister: () => {
} } : new FinalizationRegistry((n) => u.__wbg_typstcompilerbuilder_free(n >>> 0, 1));
class Bn {
  __destroy_into_raw() {
    const t = this.__wbg_ptr;
    return this.__wbg_ptr = 0, ne.unregister(this), t;
  }
  free() {
    const t = this.__destroy_into_raw();
    u.__wbg_typstcompilerbuilder_free(t, 0);
  }
  constructor() {
    try {
      const i = u.__wbindgen_add_to_stack_pointer(-16);
      u.typstcompilerbuilder_new(i);
      var t = x().getInt32(i + 4 * 0, !0), e = x().getInt32(i + 4 * 1, !0), r = x().getInt32(i + 4 * 2, !0);
      if (r)
        throw S(e);
      return this.__wbg_ptr = t >>> 0, ne.register(this, this.__wbg_ptr, this), this;
    } finally {
      u.__wbindgen_add_to_stack_pointer(16);
    }
  }
  set_dummy_access_model() {
    try {
      const r = u.__wbindgen_add_to_stack_pointer(-16);
      u.typstcompilerbuilder_set_dummy_access_model(r, this.__wbg_ptr);
      var t = x().getInt32(r + 4 * 0, !0), e = x().getInt32(r + 4 * 1, !0);
      if (e)
        throw S(t);
    } finally {
      u.__wbindgen_add_to_stack_pointer(16);
    }
  }
  /**
   * @param {any} context
   * @param {Function} mtime_fn
   * @param {Function} is_file_fn
   * @param {Function} real_path_fn
   * @param {Function} read_all_fn
   * @returns {Promise<void>}
   */
  set_access_model(t, e, r, i, o) {
    const s = u.typstcompilerbuilder_set_access_model(this.__wbg_ptr, y(t), y(e), y(r), y(i), y(o));
    return S(s);
  }
  /**
   * @param {any} context
   * @param {Function} real_resolve_fn
   * @returns {Promise<void>}
   */
  set_package_registry(t, e) {
    const r = u.typstcompilerbuilder_set_package_registry(this.__wbg_ptr, y(t), y(e));
    return S(r);
  }
  /**
   * @param {Uint8Array} data
   * @returns {Promise<void>}
   */
  add_raw_font(t) {
    const e = u.typstcompilerbuilder_add_raw_font(this.__wbg_ptr, y(t));
    return S(e);
  }
  /**
   * @param {Array<any>} fonts
   * @returns {Promise<void>}
   */
  add_web_fonts(t) {
    const e = u.typstcompilerbuilder_add_web_fonts(this.__wbg_ptr, y(t));
    return S(e);
  }
  /**
   * @returns {Promise<TypstCompiler>}
   */
  build() {
    const t = this.__destroy_into_raw(), e = u.typstcompilerbuilder_build(t);
    return S(e);
  }
}
async function zn(n, t) {
  if (typeof Response == "function" && n instanceof Response) {
    if (typeof WebAssembly.instantiateStreaming == "function")
      try {
        return await WebAssembly.instantiateStreaming(n, t);
      } catch (r) {
        if (n.headers.get("Content-Type") != "application/wasm")
          console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n", r);
        else
          throw r;
      }
    const e = await n.arrayBuffer();
    return await WebAssembly.instantiate(e, t);
  } else {
    const e = await WebAssembly.instantiate(n, t);
    return e instanceof WebAssembly.Instance ? { instance: e, module: n } : e;
  }
}
function Ie() {
  const n = {};
  return n.wbg = {}, n.wbg.__wbg_buffer_609cc3eee51ed158 = function(t) {
    const e = b(t).buffer;
    return y(e);
  }, n.wbg.__wbg_call_672a4d21634d4a24 = function() {
    return G(function(t, e) {
      const r = b(t).call(b(e));
      return y(r);
    }, arguments);
  }, n.wbg.__wbg_call_7cccdd69e0791ae2 = function() {
    return G(function(t, e, r) {
      const i = b(t).call(b(e), b(r));
      return y(i);
    }, arguments);
  }, n.wbg.__wbg_call_b8adc8b1d0a0d8eb = function() {
    return G(function(t, e, r, i, o) {
      const s = b(t).call(b(e), b(r), b(i), b(o));
      return y(s);
    }, arguments);
  }, n.wbg.__wbg_done_769e5ede4b31c67b = function(t) {
    return b(t).done;
  }, n.wbg.__wbg_entries_3265d4158b33e5dc = function(t) {
    const e = Object.entries(b(t));
    return y(e);
  }, n.wbg.__wbg_error_13f62fdb4fc06f92 = function(t, e, r) {
    console.error(b(t), b(e), b(r));
  }, n.wbg.__wbg_error_7534b8e9a36f1ab4 = function(t, e) {
    let r, i;
    try {
      r = t, i = e, console.error(q(t, e));
    } finally {
      u.__wbindgen_export_1(r, i, 1);
    }
  }, n.wbg.__wbg_getTimezoneOffset_6b5752021c499c47 = function(t) {
    return b(t).getTimezoneOffset();
  }, n.wbg.__wbg_get_67b2ba62fc30de12 = function() {
    return G(function(t, e) {
      const r = Reflect.get(b(t), b(e));
      return y(r);
    }, arguments);
  }, n.wbg.__wbg_get_b9b93047fe3cf45b = function(t, e) {
    const r = b(t)[e >>> 0];
    return y(r);
  }, n.wbg.__wbg_getwithrefkey_1dc361bd10053bfe = function(t, e) {
    const r = b(t)[b(e)];
    return y(r);
  }, n.wbg.__wbg_info_3daf2e093e091b66 = function(t) {
    console.info(b(t));
  }, n.wbg.__wbg_instanceof_ArrayBuffer_e14585432e3737fc = function(t) {
    let e;
    try {
      e = b(t) instanceof ArrayBuffer;
    } catch {
      e = !1;
    }
    return e;
  }, n.wbg.__wbg_instanceof_Map_f3469ce2244d2430 = function(t) {
    let e;
    try {
      e = b(t) instanceof Map;
    } catch {
      e = !1;
    }
    return e;
  }, n.wbg.__wbg_instanceof_Object_7f2dcef8f78644a4 = function(t) {
    let e;
    try {
      e = b(t) instanceof Object;
    } catch {
      e = !1;
    }
    return e;
  }, n.wbg.__wbg_instanceof_Uint8Array_17156bcf118086a9 = function(t) {
    let e;
    try {
      e = b(t) instanceof Uint8Array;
    } catch {
      e = !1;
    }
    return e;
  }, n.wbg.__wbg_isArray_a1eab7e0d067391b = function(t) {
    return Array.isArray(b(t));
  }, n.wbg.__wbg_isSafeInteger_343e2beeeece1bb0 = function(t) {
    return Number.isSafeInteger(b(t));
  }, n.wbg.__wbg_iterator_9a24c88df860dc65 = function() {
    return y(Symbol.iterator);
  }, n.wbg.__wbg_length_a446193dc22c12f8 = function(t) {
    return b(t).length;
  }, n.wbg.__wbg_length_e2d2a49132c1b256 = function(t) {
    return b(t).length;
  }, n.wbg.__wbg_log_53ca6abb454c8644 = function(t, e, r) {
    console.log(b(t), b(e), b(r));
  }, n.wbg.__wbg_new_23a2665fac83c611 = function(t, e) {
    try {
      var r = { a: t, b: e }, i = (s, c) => {
        const d = r.a;
        r.a = 0;
        try {
          return Wn(d, r.b, s, c);
        } finally {
          r.a = d;
        }
      };
      const o = new Promise(i);
      return y(o);
    } finally {
      r.a = r.b = 0;
    }
  }, n.wbg.__wbg_new_31a97dac4f10fab7 = function(t) {
    const e = new Date(b(t));
    return y(e);
  }, n.wbg.__wbg_new_405e22f390576ce2 = function() {
    const t = new Object();
    return y(t);
  }, n.wbg.__wbg_new_78feb108b6472713 = function() {
    const t = new Array();
    return y(t);
  }, n.wbg.__wbg_new_8a6f238a6ece86ea = function() {
    const t = new Error();
    return y(t);
  }, n.wbg.__wbg_new_a12002a7f91c75be = function(t) {
    const e = new Uint8Array(b(t));
    return y(e);
  }, n.wbg.__wbg_new_c68d7209be747379 = function(t, e) {
    const r = new Error(q(t, e));
    return y(r);
  }, n.wbg.__wbg_new_e3b321dcfef89fc7 = function(t) {
    const e = new Uint32Array(b(t));
    return y(e);
  }, n.wbg.__wbg_newnoargs_105ed471475aaf50 = function(t, e) {
    const r = new Function(q(t, e));
    return y(r);
  }, n.wbg.__wbg_newwithargs_ab6ffe8cd6c19c04 = function(t, e, r, i) {
    const o = new Function(q(t, e), q(r, i));
    return y(o);
  }, n.wbg.__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a = function(t, e, r) {
    const i = new Uint8Array(b(t), e >>> 0, r >>> 0);
    return y(i);
  }, n.wbg.__wbg_newwithbyteoffsetandlength_f1dead44d1fc7212 = function(t, e, r) {
    const i = new Uint32Array(b(t), e >>> 0, r >>> 0);
    return y(i);
  }, n.wbg.__wbg_next_25feadfc0913fea9 = function(t) {
    const e = b(t).next;
    return y(e);
  }, n.wbg.__wbg_next_6574e1a8a62d1055 = function() {
    return G(function(t) {
      const e = b(t).next();
      return y(e);
    }, arguments);
  }, n.wbg.__wbg_now_807e54c39636c349 = function() {
    return Date.now();
  }, n.wbg.__wbg_proxycontext_new = function(t) {
    const e = pt.__wrap(t);
    return y(e);
  }, n.wbg.__wbg_push_737cfc8c1432c2c6 = function(t, e) {
    return b(t).push(b(e));
  }, n.wbg.__wbg_queueMicrotask_97d92b4fcc8a61c5 = function(t) {
    queueMicrotask(b(t));
  }, n.wbg.__wbg_queueMicrotask_d3219def82552485 = function(t) {
    const e = b(t).queueMicrotask;
    return y(e);
  }, n.wbg.__wbg_resolve_4851785c9c5f573d = function(t) {
    const e = Promise.resolve(b(t));
    return y(e);
  }, n.wbg.__wbg_set_37837023f3d740e8 = function(t, e, r) {
    b(t)[e >>> 0] = S(r);
  }, n.wbg.__wbg_set_3f1d0b984ed272ed = function(t, e, r) {
    b(t)[S(e)] = S(r);
  }, n.wbg.__wbg_set_65595bdd868b3009 = function(t, e, r) {
    b(t).set(b(e), r >>> 0);
  }, n.wbg.__wbg_set_bb8cecf6a62b9f46 = function() {
    return G(function(t, e, r) {
      return Reflect.set(b(t), b(e), b(r));
    }, arguments);
  }, n.wbg.__wbg_stack_0ed75d68575b0f3c = function(t, e) {
    const r = b(e).stack, i = O(r, u.__wbindgen_export_2, u.__wbindgen_export_3), o = M;
    x().setInt32(t + 4 * 1, o, !0), x().setInt32(t + 4 * 0, i, !0);
  }, n.wbg.__wbg_static_accessor_GLOBAL_88a902d13a557d07 = function() {
    const t = typeof global > "u" ? null : global;
    return $(t) ? 0 : y(t);
  }, n.wbg.__wbg_static_accessor_GLOBAL_THIS_56578be7e9f832b0 = function() {
    const t = typeof globalThis > "u" ? null : globalThis;
    return $(t) ? 0 : y(t);
  }, n.wbg.__wbg_static_accessor_SELF_37c5d418e4bf5819 = function() {
    const t = typeof self > "u" ? null : self;
    return $(t) ? 0 : y(t);
  }, n.wbg.__wbg_static_accessor_WINDOW_5de37043a91a9c40 = function() {
    const t = typeof window > "u" ? null : window;
    return $(t) ? 0 : y(t);
  }, n.wbg.__wbg_then_44b73946d2fb3e7d = function(t, e) {
    const r = b(t).then(b(e));
    return y(r);
  }, n.wbg.__wbg_typstcompiler_new = function(t) {
    const e = ht.__wrap(t);
    return y(e);
  }, n.wbg.__wbg_value_cd1ffa7b1ab794f1 = function(t) {
    const e = b(t).value;
    return y(e);
  }, n.wbg.__wbindgen_as_number = function(t) {
    return +b(t);
  }, n.wbg.__wbindgen_bigint_from_i64 = function(t) {
    return y(t);
  }, n.wbg.__wbindgen_bigint_from_u64 = function(t) {
    const e = BigInt.asUintN(64, t);
    return y(e);
  }, n.wbg.__wbindgen_bigint_get_as_i64 = function(t, e) {
    const r = b(e), i = typeof r == "bigint" ? r : void 0;
    x().setBigInt64(t + 8 * 1, $(i) ? BigInt(0) : i, !0), x().setInt32(t + 4 * 0, !$(i), !0);
  }, n.wbg.__wbindgen_boolean_get = function(t) {
    const e = b(t);
    return typeof e == "boolean" ? e ? 1 : 0 : 2;
  }, n.wbg.__wbindgen_cb_drop = function(t) {
    const e = S(t).original;
    return e.cnt-- == 1 ? (e.a = 0, !0) : !1;
  }, n.wbg.__wbindgen_closure_wrapper794 = function(t, e, r) {
    const i = Ln(t, e, 219, jn);
    return y(i);
  }, n.wbg.__wbindgen_debug_string = function(t, e) {
    const r = Mt(b(e)), i = O(r, u.__wbindgen_export_2, u.__wbindgen_export_3), o = M;
    x().setInt32(t + 4 * 1, o, !0), x().setInt32(t + 4 * 0, i, !0);
  }, n.wbg.__wbindgen_error_new = function(t, e) {
    const r = new Error(q(t, e));
    return y(r);
  }, n.wbg.__wbindgen_in = function(t, e) {
    return b(t) in b(e);
  }, n.wbg.__wbindgen_is_bigint = function(t) {
    return typeof b(t) == "bigint";
  }, n.wbg.__wbindgen_is_function = function(t) {
    return typeof b(t) == "function";
  }, n.wbg.__wbindgen_is_object = function(t) {
    const e = b(t);
    return typeof e == "object" && e !== null;
  }, n.wbg.__wbindgen_is_string = function(t) {
    return typeof b(t) == "string";
  }, n.wbg.__wbindgen_is_undefined = function(t) {
    return b(t) === void 0;
  }, n.wbg.__wbindgen_jsval_eq = function(t, e) {
    return b(t) === b(e);
  }, n.wbg.__wbindgen_jsval_loose_eq = function(t, e) {
    return b(t) == b(e);
  }, n.wbg.__wbindgen_memory = function() {
    const t = u.memory;
    return y(t);
  }, n.wbg.__wbindgen_number_get = function(t, e) {
    const r = b(e), i = typeof r == "number" ? r : void 0;
    x().setFloat64(t + 8 * 1, $(i) ? 0 : i, !0), x().setInt32(t + 4 * 0, !$(i), !0);
  }, n.wbg.__wbindgen_number_new = function(t) {
    return y(t);
  }, n.wbg.__wbindgen_object_clone_ref = function(t) {
    const e = b(t);
    return y(e);
  }, n.wbg.__wbindgen_object_drop_ref = function(t) {
    S(t);
  }, n.wbg.__wbindgen_string_get = function(t, e) {
    const r = b(e), i = typeof r == "string" ? r : void 0;
    var o = $(i) ? 0 : O(i, u.__wbindgen_export_2, u.__wbindgen_export_3), s = M;
    x().setInt32(t + 4 * 1, s, !0), x().setInt32(t + 4 * 0, o, !0);
  }, n.wbg.__wbindgen_string_new = function(t, e) {
    const r = q(t, e);
    return y(r);
  }, n.wbg.__wbindgen_throw = function(t, e) {
    throw new Error(q(t, e));
  }, n;
}
function ke(n, t) {
  return u = n.exports, Ee.__wbindgen_wasm_module = t, J = null, Z = null, u;
}
function Un(n) {
  if (u !== void 0) return u;
  typeof n < "u" && (Object.getPrototypeOf(n) === Object.prototype ? { module: n } = n : console.warn("using deprecated parameters for `initSync()`; pass a single object instead"));
  const t = Ie();
  n instanceof WebAssembly.Module || (n = new WebAssembly.Module(n));
  const e = new WebAssembly.Instance(n, t);
  return ke(e, n);
}
async function Ee(n) {
  if (u !== void 0) return u;
  typeof n < "u" && (Object.getPrototypeOf(n) === Object.prototype ? { module_or_path: n } = n : console.warn("using deprecated parameters for the initialization function; pass a single object instead")), typeof n > "u" && (n = Se("typst_ts_web_compiler_bg.wasm", import.meta.url));
  const t = Ie();
  (typeof n == "string" || typeof Request == "function" && n instanceof Request || typeof URL == "function" && n instanceof URL) && (n = fetch(n));
  const { instance: e, module: r } = await zn(await n, t);
  return ke(e, r);
}
let Se = async function(n, t) {
  throw new Error("Cannot import wasm module without importer: " + n + " " + t);
};
function Re(n) {
  Se = n;
}
let qn = async function(n, t) {
  const e = new Function("m", "return import(m)"), { readFileSync: r } = await e("fs"), i = new URL(n, t);
  return await r(i).buffer;
};
const Nn = typeof process < "u" && process.versions != null && process.versions.node != null;
Nn && Re(qn);
const Ae = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  IncrServer: it,
  ProxyContext: pt,
  TypstCompiler: ht,
  TypstCompilerBuilder: Bn,
  default: Ee,
  get_font_info: On,
  initSync: Un,
  setImportWasmModule: Re
}, Symbol.toStringTag, { value: "Module" }));
export {
  un as FetchAccessModel,
  gn as FetchPackageRegistry,
  ge as createTypstCompiler,
  jt as createTypstRenderer,
  Xn as createTypstSvgRenderer,
  St as preloadRemoteFonts,
  Ot as preloadSystemFonts,
  Qn as rendererBuildInfo
};
